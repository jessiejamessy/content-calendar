<script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            const { db, auth, doc, setDoc, deleteDoc, onSnapshot, collection, addDoc, getDocs, query, where, signInAnonymously, onAuthStateChanged, signOut, GoogleAuthProvider, signInWithPopup } = window.firebase;
            
            // NOTE: Re-added appId and corrected all database paths to match your project's structure.
            const appId = window.firebase.appId || "contentcalendar-10154"; // Fallback just in case

            // --- Configuration ---
            const ALL_PLATFORMS = ['Facebook', 'Instagram', 'TikTok', 'Blog', 'LinkedIn', 'X', 'Behance', 'YouTube'];
            const platformColors = {'Facebook': '#1877F2', 'Instagram': '#E4405F', 'TikTok': '#000000', 'Blog': '#FF5722', 'LinkedIn': '#0A66C2', 'X': '#000000', 'Behance': '#0057FF', 'YouTube': '#FF0000', 'default': '#64748b'};

            // --- State Variables ---
            let weeklyPosts = [], weeklyTitles = {}, isAdminLoggedIn = false;
            let currentWeekStartDate = getWeekStartDate(new Date(), 'Monday');
            let platformChart, statusChart, postIdToDelete = null;
            let unsubscribePosts = () => {}, unsubscribeTitles = () => {};

            // --- UI Elements ---
            const ui = {
                platformFilter: document.getElementById('platformFilter'),
                statusFilter: document.getElementById('statusFilter'),
                weekStartDayFilter: document.getElementById('weekStartDayFilter'),
                darkModeToggle: document.getElementById('darkModeToggle'),
                currentWeekDisplay: document.getElementById('currentWeekDisplay'),
                weeklyTitleDisplay: document.getElementById('weeklyTitleDisplay'),
                editWeeklyTitleBtn: document.getElementById('editWeeklyTitleBtn'),
                currentWeekGrid: document.getElementById('current-week-grid'),
                postedDailyGrid: document.getElementById('posted-daily-grid'),
                allPostedContentContainer: document.getElementById('all-posted-content-container'),
                addPostBtn: document.getElementById('addPostBtn'),
                loggedInUserDisplay: document.getElementById('loggedInUserDisplay'),
                adminLoginBtn: document.getElementById('adminLoginBtn'),
                adminLogoutBtn: document.getElementById('adminLogoutBtn'),
                postModal: document.getElementById('postModal'),
                postForm: document.getElementById('postForm'),
                modalTitle: document.getElementById('modalTitle'),
                platformsCheckboxContainer: document.getElementById('platforms-checkbox-container'),
                cancelBtn: document.getElementById('cancelBtn'),
                deleteConfirmModal: document.getElementById('deleteConfirmModal'),
                confirmDeleteBtn: document.getElementById('confirmDeleteBtn'),
                cancelDeleteBtn: document.getElementById('cancelDeleteBtn'),
                prevWeekBtn: document.getElementById('prevWeekBtn'),
                nextWeekBtn: document.getElementById('nextWeekBtn'),
                statusChartTitle: document.getElementById('statusChartTitle'),
                trashSection: document.getElementById('trash-section'),
                trashContainer: document.getElementById('trash-container'),
                permanentDeleteConfirmModal: document.getElementById('permanentDeleteConfirmModal'),
                cancelPermanentDeleteBtn: document.getElementById('cancelPermanentDeleteBtn'),
                confirmPermanentDeleteBtn: document.getElementById('confirmPermanentDeleteBtn'),
                titleModal: document.getElementById('titleModal'),
                titleForm: document.getElementById('titleForm'),
                weeklyTitleInput: document.getElementById('weeklyTitleInput'),
                cancelTitleBtn: document.getElementById('cancelTitleBtn'),
            };
            
            // --- Helper Functions ---
            function getWeekStartDate(d, startDayName) { d = new Date(d); d.setHours(0, 0, 0, 0); const day = d.getDay(); const diff = (startDayName === 'Monday') ? d.getDate() - day + (day === 0 ? -6 : 1) : d.getDate() - day; return new Date(new Date(d.setDate(diff)).setHours(0, 0, 0, 0)); }
            function formatDate(date) { return date.toISOString().split('T')[0]; }

            // --- Corrected Database Path Helpers ---
            const postsCollectionPath = () => collection(db, `artifacts/${appId}/public/data/posts`);
            const postDocumentPath = (id) => doc(db, `artifacts/${appId}/public/data/posts`, id);
            const titlesCollectionPath = () => collection(db, `artifacts/${appId}/public/data/weekly_titles`);
            const titleDocumentPath = (id) => doc(db, `artifacts/${appId}/public/data/weekly_titles`, id);


            // --- Authentication ---
            onAuthStateChanged(auth, user => {
                // For true security, you should use custom claims to verify an admin.
                // For now, any logged-in user is treated as an admin.
                isAdminLoggedIn = !!user; 
                updateAdminUI(user);
                fetchDataForCurrentWeek(); // Fetch data after auth state is determined
            });

            async function handleLogin() {
                const provider = new GoogleAuthProvider();
                try {
                    await signInWithPopup(auth, provider);
                } catch (error) {
                    console.error("Login failed:", error);
                    if (error.code === 'auth/popup-blocked') {
                        alert("Login popup was blocked by the browser. Please allow popups for this site.");
                    } else {
                         alert("Could not log in. See console for details.");
                    }
                }
            }

            async function handleLogout() {
                await signOut(auth);
            }

            function updateAdminUI(user) {
                ui.addPostBtn.disabled = !isAdminLoggedIn;
                ui.addPostBtn.classList.toggle('opacity-50', !isAdminLoggedIn);
                ui.adminLoginBtn.classList.toggle('hidden', !!user);
                ui.adminLogoutBtn.classList.toggle('hidden', !user);
                ui.editWeeklyTitleBtn.classList.toggle('hidden', !isAdminLoggedIn);
                ui.trashSection.classList.toggle('hidden', !isAdminLoggedIn);

                if (user) {
                    ui.loggedInUserDisplay.textContent = `Logged in as: ${user.displayName || user.email}`;
                } else {
                    ui.loggedInUserDisplay.textContent = 'Not Logged In';
                }
                renderAllContent(); 
            }

            // --- Data Fetching ---
            function fetchDataForCurrentWeek() {
                unsubscribePosts(); // Unsubscribe from previous listener
                unsubscribeTitles();

                if (!auth.currentUser) {
                    console.log("Not logged in. Clearing weekly data.");
                    weeklyPosts = [];
                    renderAllContent();
                    return;
                }

                const weekStart = currentWeekStartDate;
                const weekEnd = new Date(new Date(weekStart).setDate(weekStart.getDate() + 7));
                
                const postsQuery = query(postsCollectionPath(), where("publishDate", ">=", formatDate(weekStart)), where("publishDate", "<", formatDate(weekEnd)));
                
                unsubscribePosts = onSnapshot(postsQuery, snap => {
                    weeklyPosts = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    populateFilters();
                    renderAllContent();
                }, (error) => {
                     console.error("Error fetching weekly posts:", error);
                     alert("Could not load post data. Check browser console for Firestore permission errors or missing indexes.");
                });
                
                unsubscribeTitles = onSnapshot(titlesCollectionPath(), snap => {
                    weeklyTitles = {};
                    snap.docs.forEach(d => { weeklyTitles[d.id] = d.data().title; });
                    renderAllContent();
                }, (error) => console.error("Error fetching weekly titles:", error));
            }


            // --- Rendering ---
            function renderAllContent() {
                // This function is large but its internal logic does not need to change.
                const weekStart = currentWeekStartDate;
                const weekId = formatDate(weekStart);
                const filteredWeeklyPosts = weeklyPosts.filter(p => (ui.platformFilter.value === 'All Platforms' || (p.platforms && p.platforms.includes(ui.platformFilter.value))) && (ui.statusFilter.value === 'All Statuses' || p.status === ui.statusFilter.value));
                const activePostsInWeek = weeklyPosts.filter(p => !p.isTrashed);
                const postsForCharts = (ui.platformFilter.value === 'All Platforms') ? activePostsInWeek : activePostsInWeek.filter(p => p.platforms && p.platforms.includes(ui.platformFilter.value));
                const postedThisWeek = activePostsInWeek.filter(p => p.status === 'Posted' && (ui.platformFilter.value === 'All Platforms' || (p.platforms && p.platforms.includes(ui.platformFilter.value))));
                const trashedPostsInWeek = weeklyPosts.filter(p => p.isTrashed);
                ui.currentWeekDisplay.textContent = `${weekStart.toLocaleDateString()} - ${new Date(new Date(weekStart).setDate(weekStart.getDate() + 6)).toLocaleDateString()}`;
                const currentTitle = weeklyTitles[weekId];
                ui.weeklyTitleDisplay.textContent = currentTitle || '';
                ui.editWeeklyTitleBtn.textContent = currentTitle ? '[Edit Title]' : '[Add Title]';
                ['currentWeekGrid', 'postedDailyGrid', 'allPostedContentContainer', 'trashContainer'].forEach(id => ui[id] && (ui[id].innerHTML = ''));
                const orderedDays = (ui.weekStartDayFilter.value === 'Monday') ? ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                for (let i = 0; i < 7; i++) {
                    const dayCol = document.createElement('div');
                    dayCol.className = 'day-column rounded-lg p-2 space-y-2';
                    dayCol.innerHTML = `<h3 class="font-bold text-base text-center section-heading mb-2">${orderedDays[i]}</h3>`;
                    ui.currentWeekGrid.appendChild(dayCol);
                    ui.postedDailyGrid.appendChild(dayCol.cloneNode(true));
                }
                filteredWeeklyPosts.forEach(post => { 
                    const pDate = new Date(post.publishDate + 'T00:00:00');
                    let dayIndex = pDate.getUTCDay(); 
                    if (ui.weekStartDayFilter.value === 'Monday') dayIndex = (dayIndex === 0) ? 6 : dayIndex - 1;
                    const grid = post.status === 'Posted' ? ui.postedDailyGrid : ui.currentWeekGrid;
                    if (grid.children[dayIndex] && !post.isTrashed) grid.children[dayIndex].appendChild(createPostCard(post)); 
                });
                postedThisWeek.forEach(post => ui.allPostedContentContainer.appendChild(createPostCard(post)));
                if (isAdminLoggedIn) {
                    trashedPostsInWeek.forEach(post => ui.trashContainer.appendChild(createPostCard(post, true)));
                }
                renderCharts(postsForCharts);
            }

            function createPostCard(post, isTrashView = false) {
                // This function's internal logic is correct and does not need to change.
                const card = document.createElement('div');
                card.className = 'bg-white/70 dark:bg-slate-900/70 backdrop-blur-sm p-2.5 rounded-lg shadow-md hover:shadow-lg transition-shadow relative space-y-2';
                const platformsHtml = (post.platforms || []).map(p => `<span class="platform-tag bg-${p.toLowerCase()}">${p}</span>`).join('');
                const viewPostButton = (post.outputLink && post.status === 'Posted') ? `<a href="${post.outputLink}" target="_blank" rel="noopener noreferrer" class="text-xs bg-blue-500 text-white px-2 py-1 rounded-full hover:bg-blue-600">View Post</a>` : '';
                const editButtonHtml = isAdminLoggedIn && !isTrashView ? `<button class="absolute top-1 right-8 text-slate-400 hover:text-blue-500 edit-post-btn"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg></button>` : '';
                const deleteButtonHtml = isAdminLoggedIn && !isTrashView ? `<button class="absolute top-1 right-1 text-slate-400 hover:text-red-500 delete-post-btn"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg></button>` : '';
                const trashButtonsHtml = isTrashView ? `<div class="flex justify-end gap-2 mt-2"><button data-id="${post.id}" class="restore-post-btn text-xs bg-green-500 text-white px-2 py-1 rounded-full hover:bg-green-600">Restore</button><button data-id="${post.id}" class="permanent-delete-btn text-xs bg-red-600 text-white px-2 py-1 rounded-full hover:bg-red-700">Delete Forever</button></div>` : '';
                card.innerHTML = `<h4 class="font-bold text-sm section-heading truncate">${post.topic || 'Untitled Post'}</h4><div class="flex flex-wrap gap-1">${platformsHtml}</div><p class="text-xs text-slate-600"><strong>Type:</strong> ${post.type || 'N/A'}</p><div class="flex justify-between items-center"><span class="status-tag bg-${post.status.replace(/\s+/g, '-').toLowerCase()}-200 text-${post.status.replace(/\s+/g, '-').toLowerCase()}-800">${post.status}</span>${viewPostButton}</div>${editButtonHtml}${deleteButtonHtml}${trashButtonsHtml}`;
                if (isAdminLoggedIn && !isTrashView) {
                    card.querySelector('.edit-post-btn')?.addEventListener('click', (e) => { e.stopPropagation(); openModal(post); });
                    card.querySelector('.delete-post-btn')?.addEventListener('click', (e) => { e.stopPropagation(); showDeleteConfirm(post.id); });
                }
                return card;
            }

            function populateFilters() {
                // This function's internal logic is correct and does not need to change.
                const allPlatformsInWeek = new Set(weeklyPosts.filter(p => !p.isTrashed).flatMap(p => p.platforms || []));
                const currentFilterValue = ui.platformFilter.value;
                ui.platformFilter.innerHTML = '<option>All Platforms</option>';
                Array.from(allPlatformsInWeek).sort().forEach(platform => {
                    const option = document.createElement('option');
                    option.value = platform;
                    option.textContent = platform;
                    ui.platformFilter.appendChild(option);
                });
                if (Array.from(allPlatformsInWeek).includes(currentFilterValue)) {
                    ui.platformFilter.value = currentFilterValue;
                }
            }
            
            function renderCharts(data) {
                // This function's internal logic is correct and does not need to change.
                const isDarkMode = document.documentElement.classList.contains('dark'); const chartColors = { text: isDarkMode ? '#e5e7eb' : '#475569', border: isDarkMode ? '#475569' : '#e2e8f0' }; const selectedPlatform = ui.platformFilter.value; const platformCounts = {}; (selectedPlatform === 'All Platforms' ? data : data.filter(p => p.platforms.includes(selectedPlatform))).forEach(post => (post.platforms || []).forEach(p => platformCounts[p] = (platformCounts[p] || 0) + 1)); if(platformChart) platformChart.destroy(); platformChart = new Chart('platformChart', { type: 'doughnut', data: { labels: Object.keys(platformCounts), datasets: [{ data: Object.values(platformCounts), backgroundColor: Object.keys(platformCounts).map(p => platformColors[p] || platformColors.default) }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: chartColors.text } } } } }); const statuses = ['To Do', 'In Progress', 'For Approval', 'Scheduled', 'Posted']; if(statusChart) statusChart.destroy(); if (selectedPlatform === 'All Platforms') { ui.statusChartTitle.textContent = 'Content Status by Platform'; const platformsInData = [...new Set(data.flatMap(p => p.platforms || []))].sort(); const statusDatasets = platformsInData.map(platform => ({ label: platform, data: statuses.map(status => data.filter(post => post.status === status && (post.platforms || []).includes(platform)).length), backgroundColor: platformColors[platform] || platformColors.default })); statusChart = new Chart('statusChart', { type: 'bar', data: { labels: statuses, datasets: statusDatasets }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: chartColors.text } } }, scales: { x: { stacked: true, ticks: {color: chartColors.text}, grid:{color:chartColors.border} }, y: { stacked: true, ticks: {color: chartColors.text}, grid:{color:chartColors.border} } } } }); } else { ui.statusChartTitle.textContent = `Content Status for ${selectedPlatform}`; const statusCounts = {'To Do':0, 'In Progress':0, 'For Approval':0, 'Scheduled':0, 'Posted':0}; data.forEach(post => { if(statusCounts.hasOwnProperty(post.status)) statusCounts[post.status]++; }); const singleDataset = [{ label: selectedPlatform, data: Object.values(statusCounts), backgroundColor: platformColors[selectedPlatform] || platformColors.default }]; statusChart = new Chart('statusChart', { type: 'bar', data: { labels: statuses, datasets: singleDataset }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { ticks: {color: chartColors.text}, grid:{color:chartColors.border} }, y: { ticks: {color: chartColors.text}, grid:{color:chartColors.border} } } } }); }
            }
            
            // --- Modal & Form Handling ---
            function openModal(post = null) {
                // This function's internal logic is correct and does not need to change.
                ui.postForm.reset();
                document.getElementById('postId').value = post?.id || '';
                ui.modalTitle.textContent = post ? 'Edit Content' : 'Add New Content';
                if (post) { Object.keys(post).forEach(key => { const el = document.getElementById(key === 'type' ? 'contentType' : key); if (el && el.type !== 'checkbox') el.value = post[key]; }); } else { document.getElementById('publishDate').value = formatDate(new Date()); }
                ui.platformsCheckboxContainer.innerHTML = '';
                ALL_PLATFORMS.forEach(platform => {
                    const isChecked = post?.platforms?.includes(platform);
                    ui.platformsCheckboxContainer.innerHTML += `<label class="flex items-center space-x-2 text-sm"><input type="checkbox" name="platforms" value="${platform}" ${isChecked ? 'checked' : ''} class="rounded"><span>${platform}</span></label>`;
                });
                ui.postModal.classList.remove('hidden');
                ui.postModal.classList.add('flex');
            }

            async function handleFormSubmit(e) {
                e.preventDefault();
                if (!isAdminLoggedIn) return alert("You must be logged in to save posts.");
                const id = document.getElementById('postId').value;
                const selectedPlatforms = Array.from(ui.platformsCheckboxContainer.querySelectorAll('input:checked')).map(cb => cb.value);
                const postData = { topic: document.getElementById('contentTopic').value, publishDate: document.getElementById('publishDate').value, status: document.getElementById('status').value, platforms: selectedPlatforms, type: document.getElementById('contentType').value, resources: document.getElementById('resources').value, notes: document.getElementById('notes').value, outputLink: document.getElementById('outputLink').value, isTrashed: false };
                try {
                    const docRef = id ? postDocumentPath(id) : doc(postsCollectionPath());
                    await setDoc(docRef, postData, { merge: true });
                    closeModal();
                } catch (err) { console.error("Error saving post:", err); alert("Error saving post. See console for details."); }
            }
            
            // --- CRUD Operations ---
            async function deletePost() { if(!postIdToDelete) return; await setDoc(postDocumentPath(postIdToDelete), { isTrashed: true }, { merge: true }); hideDeleteConfirm(); }
            async function permanentlyDeletePost() { if(!postIdToDelete) return; await deleteDoc(postDocumentPath(postIdToDelete)); hidePermanentDeleteConfirm(); }
            async function restorePost(id) { if(!id) return; await setDoc(postDocumentPath(id), { isTrashed: false }, { merge: true }); }

            // --- Weekly Title ---
            async function handleTitleFormSubmit(e) {
                e.preventDefault();
                const weekId = formatDate(currentWeekStartDate);
                const newTitle = ui.weeklyTitleInput.value.trim();
                const titleRef = titleDocumentPath(weekId);
                try {
                    if (newTitle) { await setDoc(titleRef, { title: newTitle }); } else { await deleteDoc(titleRef); }
                    closeTitleModal();
                } catch(err) { console.error("Error saving title:", err); alert("Could not save title."); }
            }

            // --- Setup Functions (no changes needed in this section) ---
            function closeModal() { ui.postModal.classList.add('hidden'); }
            function showDeleteConfirm(id) { postIdToDelete = id; ui.deleteConfirmModal.classList.remove('hidden'); ui.deleteConfirmModal.classList.add('flex'); }
            function hideDeleteConfirm() { ui.deleteConfirmModal.classList.add('hidden'); }
            function showPermanentDeleteConfirm(id) { postIdToDelete = id; ui.permanentDeleteConfirmModal.classList.remove('hidden'); ui.permanentDeleteConfirmModal.classList.add('flex'); }
            function hidePermanentDeleteConfirm() { ui.permanentDeleteConfirmModal.classList.add('hidden'); }
            function openTitleModal() { const weekId = formatDate(currentWeekStartDate); ui.weeklyTitleInput.value = weeklyTitles[weekId] || ''; ui.titleModal.classList.remove('hidden'); ui.titleModal.classList.add('flex'); }
            function closeTitleModal() { ui.titleModal.classList.add('hidden'); }
            function setupEventListeners() {
                ui.platformFilter.addEventListener('change', renderAllContent);
                ui.statusFilter.addEventListener('change', renderAllContent);
                ui.weekStartDayFilter.addEventListener('change', e => { currentWeekStartDate = getWeekStartDate(currentWeekStartDate, e.target.value); fetchDataForCurrentWeek(); });
                ui.darkModeToggle.addEventListener('change', () => { const isDark = document.documentElement.classList.toggle('dark'); localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled'); renderCharts(weeklyPosts.filter(p => !p.isTrashed)); });
                ui.addPostBtn.addEventListener('click', () => openModal());
                ui.cancelBtn.addEventListener('click', closeModal);
                ui.postForm.addEventListener('submit', handleFormSubmit);
                ui.prevWeekBtn.addEventListener('click', () => { currentWeekStartDate.setDate(currentWeekStartDate.getDate() - 7); fetchDataForCurrentWeek(); });
                ui.nextWeekBtn.addEventListener('click', () => { currentWeekStartDate.setDate(currentWeekStartDate.getDate() + 7); fetchDataForCurrentWeek(); });
                ui.adminLoginBtn.addEventListener('click', handleLogin);
                ui.adminLogoutBtn.addEventListener('click', handleLogout);
                ui.confirmDeleteBtn.addEventListener('click', deletePost);
                ui.cancelDeleteBtn.addEventListener('click', hideDeleteConfirm);
                ui.confirmPermanentDeleteBtn.addEventListener('click', permanentlyDeletePost);
                ui.cancelPermanentDeleteBtn.addEventListener('click', hidePermanentDeleteConfirm);
                ui.editWeeklyTitleBtn.addEventListener('click', openTitleModal);
                ui.titleForm.addEventListener('submit', handleTitleFormSubmit);
                ui.cancelTitleBtn.addEventListener('click', closeTitleModal);
                ui.trashContainer.addEventListener('click', e => {
                    const restoreBtn = e.target.closest('.restore-post-btn');
                    if (restoreBtn) restorePost(restoreBtn.dataset.id);
                    const permanentDeleteBtn = e.target.closest('.permanent-delete-btn');
                    if (permanentDeleteBtn) showPermanentDeleteConfirm(permanentDeleteBtn.dataset.id);
                });
                [ui.postModal, ui.deleteConfirmModal, ui.permanentDeleteConfirmModal, ui.titleModal].forEach(modal => modal.addEventListener('click', e => { if (e.target === modal) e.currentTarget.classList.add('hidden'); }));
            }

            // --- Initial Load ---
            (function init() {
                // This part should be at the very top of your HTML, so window.firebase.appId is available
                // I've added a fallback to the code but it's best practice to ensure it loads first.
                if (!window.firebase) {
                    alert("Firebase did not load correctly. Please check the script tags in your HTML head.");
                    return;
                }
                if (localStorage.getItem('darkMode') === 'enabled') {
                    document.documentElement.classList.add('dark');
                    ui.darkModeToggle.checked = true;
                }
                setupEventListeners();
            })();
        });
    </script>
