<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Cowboy Interactive Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rye&display=swap" rel="stylesheet">
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, deleteDoc, onSnapshot, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAqOoWBpthRQBI7Xgi-co3-Wrf8jX_nPnY",
            authDomain: "contentcalendar-10154.firebaseapp.com",
            projectId: "contentcalendar-10154",
            storageBucket: "contentcalendar-10154.firebasestorage.app",
            messagingSenderId: "309580896666",
            appId: "1:309580896666:web:9d987624d2efd644960223"
        };
        
        const appId = firebaseConfig.projectId;
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        window.firebaseDb = db;
        window.firebaseAuth = auth;
        window.firebaseAppId = appId;
        window.firebaseDoc = doc;
        window.firebaseGetDoc = getDoc;
        window.firebaseSetDoc = setDoc;
        window.firebaseDeleteDoc = deleteDoc;
        window.firebaseOnSnapshot = onSnapshot;
        window.firebaseCollection = collection;
        window.firebaseAddDoc = addDoc;
        window.firebaseGetDocs = getDocs;
        window.firebaseSignInAnonymously = signInAnonymously;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .chart-container { position: relative; width: 100%; max-width: 450px; margin: auto; }
        .day-column { min-height: 200px; min-width: 140px; }
        .modal-bg { background-color: rgba(0,0,0,0.5); }
        .horizontal-scroll-container { overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 8px; }
        .horizontal-scroll-container::-webkit-scrollbar { height: 8px; }
        .horizontal-scroll-container::-webkit-scrollbar-track { background: #e2e8f0; border-radius: 10px; }
        .dark .horizontal-scroll-container::-webkit-scrollbar-track { background: #1e293b; }
        .horizontal-scroll-container::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        .dark .horizontal-scroll-container::-webkit-scrollbar-thumb { background: #475569; }
        
        .dark { background-color: #0f172a; color: #e2e8f0; }
        .dark .text-slate-800 { color: #e2e8f0; }
        .dark .text-slate-600, .dark .text-slate-500 { color: #94a3b8; }
        .dark .bg-white { background-color: #1e293b; }
        .dark .bg-slate-100 { background-color: #162135; }
        .dark .bg-slate-200, .dark .bg-slate-300 { background-color: #334155; }
        
        .day-column, .analytics-card {
            background-color: #ffffff;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .dark .day-column, .dark .analytics-card {
            background-color: #1e293b;
            box-shadow: none;
        }

        #modal-content { background-color: #f8fafc; }
        #postModal label { color: #1f2937; }
        #postModal input, #postModal select, #postModal textarea { background-color: #ffffff; border: 1px solid #000000; }
        .filter-select { background-color: #ffffff; color: #111827; border: 1px solid #d1d5db; }

        .section-heading { color: #374151; }
        .dark .section-heading { color: #e5e7eb; }

        .dark #postModal label { color: #cbd5e1; }
        .dark #modal-content { background-color: #1e293b; }
        .dark #postModal input, .dark #postModal select, .dark #postModal textarea { background-color: #334155; border: 1px solid #64748b; }
        .dark .filter-select { background-color: #e2e8f0; color: #111827; border: 1px solid #475569; }

        .western-font { font-family: 'Rye', cursive, sans-serif; text-shadow: 2px 2px 3px rgba(0,0,0,0.4); }
        .status-tag { font-size: 10px; font-weight: 600; display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 9999px; }
        .platform-tag { display: inline-block; font-size: 10px; font-weight: 600; margin-right: 6px; padding: 2px 8px; border-radius: 9999px; }
        .bg-facebook { background-color: #1877F2; color: #fff; } .bg-instagram { background-color: #E4405F; color: #fff; } .bg-tiktok { background-color: #000; color: #fff; } .bg-blog { background-color: #FF5722; color: #fff; } .bg-linkedin { background-color: #0A66C2; color: #fff; } .bg-x { background-color: #000; color: #fff; } .bg-behance { background-color: #0057FF; color: #fff; } .bg-youtube { background-color: #FF0000; color: #fff; }
        .bg-rose-200 { background-color: #ffe4e6; } .text-rose-800 { color: #9f1239; } .dark .bg-rose-200 { background-color: #9f1239; } .dark .text-rose-800 { color: #fecaca; }
        .bg-amber-200 { background-color: #fef3c7; } .text-amber-800 { color: #92400e; } .dark .bg-amber-200 { background-color: #92400e; } .dark .text-amber-800 { color: #fcd34d; }
        .bg-sky-200 { background-color: #e0f2fe; } .text-sky-800 { color: #075985; } .dark .bg-sky-200 { background-color: #0c4a6e; } .dark .text-sky-800 { color: #bae6fd; }
        .bg-emerald-200 { background-color: #d1fae5; } .text-emerald-800 { color: #065f46; } .dark .bg-emerald-200 { background-color: #065f46; } .dark .text-emerald-800 { color: #a7f3d0; }
        .bg-violet-200 { background-color: #e9d5ff; } .text-violet-800 { color: #7e22ce; } .dark .bg-violet-200 { background-color: #6d28d9; } .dark .text-violet-800 { color: #d8b4fe; }
    </style>
</head>
<body class="antialiased text-slate-800">

    <div id="main-container" class="container mx-auto p-4 md:p-6">

        <header class="text-center mb-6">
            <div class="flex items-center justify-center mb-2">
                <img src="data:image/jpeg;base64,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" alt="Content Cowboy Logo" class="h-10 sm:h-12 mr-4">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold western-font section-heading">Content Cowboy Interactive Calendar</h1>
            </div>
            <p class="text-slate-600 mt-2 text-sm sm:text-base md:text-lg">A dynamic view of your weekly content schedule.</p>
        </header>

        <div class="bg-white p-3 sm:p-4 rounded-xl shadow-md mb-6 sticky top-4 z-10">
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-y-3 gap-x-4">
                <div class="col-span-2 md:col-span-3 lg:col-span-1">
                    <h2 class="font-bold text-lg md:text-xl section-heading">Filter Controls</h2>
                </div>
                <div>
                    <label for="platformFilter" class="block text-xs font-medium text-slate-700 dark:text-slate-300">Platform</label>
                    <select id="platformFilter" class="filter-select mt-1 block w-full pl-3 pr-10 py-1.5 text-sm rounded-md shadow-sm"><option>All Platforms</option></select>
                </div>
                <div>
                    <label for="statusFilter" class="block text-xs font-medium text-slate-700 dark:text-slate-300">Status</label>
                    <select id="statusFilter" class="filter-select mt-1 block w-full pl-3 pr-10 py-1.5 text-sm rounded-md shadow-sm"><option>All Statuses</option><option>To Do</option><option>In Progress</option><option>For Approval</option><option>Scheduled</option><option>Posted</option></select>
                </div>
                <div class="col-span-2 sm:col-span-1">
                    <label for="weekStartDayFilter" class="block text-xs font-medium text-slate-700 dark:text-slate-300">Week Starts On</label>
                    <select id="weekStartDayFilter" class="filter-select mt-1 block w-full pl-3 pr-10 py-1.5 text-sm rounded-md shadow-sm"><option value="Monday">Monday</option><option value="Sunday">Sunday</option></select>
                </div>
                <div class="col-span-2 sm:col-span-2 lg:col-span-1 flex flex-row gap-2">
                    <button id="addPostBtn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-3 rounded-lg shadow-md text-sm">Add Post</button>
                    <button id="adminLogoutBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded-lg shadow-md text-sm hidden">Logout</button>
                    <button id="adminLoginBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-lg shadow-md text-sm">Login</button>
                </div>
                <div class="col-span-2 md:col-span-3 lg:col-span-5 border-t border-slate-200 dark:border-slate-700 pt-3 mt-2 flex justify-between items-center gap-4">
                    <label for="darkModeToggle" class="flex items-center cursor-pointer"><div class="relative"><input type="checkbox" id="darkModeToggle" class="sr-only"><div class="block bg-slate-600 w-14 h-8 rounded-full"></div><div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div></div><div class="ml-3 text-sm">Dark Mode</div></label>
                    <div class="text-right"><span id="loggedInUserDisplay" class="text-xs font-medium text-slate-500 block">Not Logged In</span><span id="currentUserIdDisplay" class="text-xs font-medium text-slate-500 block"></span></div>
                </div>
            </div>
        </div>

        <section id="week-navigation" class="bg-white p-3 rounded-xl shadow-md mb-6 flex justify-between items-center gap-2">
            <button id="prevWeekBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-lg"><span class="hidden sm:inline">&larr; Previous</span><span class="sm:hidden">&larr;</span></button>
            <div class="text-center">
                <div class="text-sm md:text-lg font-semibold text-center section-heading" id="currentWeekDisplay"></div>
                <div class="mt-1">
                    <span id="weeklyTitleDisplay" class="text-lg md:text-xl font-bold section-heading"></span>
                    <button id="editWeeklyTitleBtn" class="ml-2 text-xs text-blue-500 hover:underline hidden">[Edit]</button>
                </div>
            </div>
            <button id="nextWeekBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-lg"><span class="hidden sm:inline">Next &rarr;</span><span class="sm:hidden">&rarr;</span></button>
        </section>
        
        <section id="analytics" class="mb-6">
            <h2 class="text-xl md:text-3xl font-bold section-heading mb-4 text-center">Weekly Analytics Overview</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="analytics-card p-4 rounded-xl"><h3 class="text-base md:text-xl font-semibold text-center section-heading mb-4">Content Distribution</h3><div class="chart-container h-[250px] sm:h-[300px]"><canvas id="platformChart"></canvas></div></div>
                <div class="analytics-card p-4 rounded-xl"><h3 id="statusChartTitle" class="text-base md:text-xl font-semibold text-center section-heading mb-4">Content Status</h3><div class="chart-container h-[250px] sm:h-[300px]"><canvas id="statusChart"></canvas></div></div>
            </div>
        </section>

        <main id="calendar">
            <h2 class="text-xl md:text-3xl font-bold section-heading mb-2 text-center">Current Week Content</h2>
            <p class="text-slate-500 text-center mb-4 text-xs md:text-sm">(Scroll horizontally to see all days)</p>
            <div class="horizontal-scroll-container bg-slate-100 rounded-lg"><div id="current-week-grid" class="grid grid-cols-7 gap-2" style="min-width: 980px;"></div></div>
        </main>
        
        <section id="posted-daily-calendar" class="mt-8">
            <h2 class="text-xl md:text-3xl font-bold section-heading mb-2 text-center">Posted Content by Day</h2>
            <p class="text-slate-500 text-center mb-4 text-xs md:text-sm">(Scroll horizontally to see all days)</p>
            <div class="horizontal-scroll-container bg-slate-100 rounded-lg"><div id="posted-daily-grid" class="grid grid-cols-7 gap-2" style="min-width: 980px;"></div></div>
        </section>

        <section id="all-posted-content-section" class="mt-8">
            <h2 class="text-xl md:text-3xl font-bold section-heading mb-4 text-center">Posted Content (This Week)</h2>
            <div id="all-posted-content-container" class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4"></div>
        </section>

        <section id="trash-section" class="mt-8 hidden">
            <h2 class="text-xl md:text-3xl font-bold section-heading mb-4 text-center">Trash (This Week)</h2>
            <div id="trash-container" class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4"></div>
        </section>
    </div>

    <div id="postModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4">
        <div class="rounded-lg shadow-2xl p-6 w-full max-w-lg" id="modal-content">
            <h2 id="modalTitle" class="text-2xl font-bold mb-6 section-heading"></h2>
            <form id="postForm" class="space-y-4">
                <input type="hidden" id="postId">
                <div><label for="contentTopic">Content Topic</label><input type="text" id="contentTopic" class="mt-1 block w-full border rounded-md p-2" required></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label for="publishDate">Publish Date</label><input type="date" id="publishDate" class="mt-1 block w-full border rounded-md p-2" required></div>
                    <div><label for="status">Status</label><select id="status" class="mt-1 block w-full border rounded-md p-2"><option>To Do</option><option>In Progress</option><option>For Approval</option><option>Scheduled</option><option>Posted</option></select></div>
                </div>
                <div><label for="platforms">Platforms (comma-separated)</label><input type="text" id="platforms" class="mt-1 block w-full border rounded-md p-2" required></div>
                <div><label for="contentType">Content Type</label><input type="text" id="contentType" class="mt-1 block w-full border rounded-md p-2" required></div>
                <div><label for="resources">Resources (link or notes)</label><input type="text" id="resources" class="mt-1 block w-full border rounded-md p-2"></div>
                <div><label for="notes">Notes/Details</label><textarea id="notes" class="mt-1 block w-full border rounded-md p-2" rows="3"></textarea></div>
                <div><label for="outputLink">Output Link (URL for "View Post" button)</label><input type="url" id="outputLink" class="mt-1 block w-full border rounded-md p-2"></div>
                <div class="flex justify-end gap-4 pt-4"><button type="button" id="cancelBtn" class="bg-slate-300 font-bold py-2 px-4 rounded-lg">Cancel</button><button type="submit" id="saveBtn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg">Save Post</button></div>
            </form>
        </div>
    </div>
    <div id="deleteConfirmModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4"><div class="bg-white dark:bg-slate-800 rounded-lg p-8 w-full max-w-sm"><h2 class="text-xl font-bold section-heading mb-4">Confirm Deletion</h2><p class="text-slate-600 mb-6">This will move the post to the trash.</p><div class="flex justify-end gap-4"><button type="button" id="cancelDeleteBtn" class="bg-slate-300 font-bold py-2 px-4 rounded-lg">Cancel</button><button type="button" id="confirmDeleteBtn" class="bg-red-500 text-white font-bold py-2 px-4 rounded-lg">Delete</button></div></div></div>
    <div id="permanentDeleteConfirmModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4"><div class="bg-white dark:bg-slate-800 rounded-lg p-8 w-full max-w-sm"><h2 class="text-xl font-bold section-heading mb-4 text-red-500">Permanently Delete?</h2><p class="text-slate-600 mb-6">This action is irreversible and cannot be undone.</p><div class="flex justify-end gap-4"><button type="button" id="cancelPermanentDeleteBtn" class="bg-slate-300 font-bold py-2 px-4 rounded-lg">Cancel</button><button type="button" id="confirmPermanentDeleteBtn" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Delete Forever</button></div></div></div>
    <div id="loginModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4"><div class="bg-white dark:bg-slate-800 rounded-lg p-8 w-full max-w-sm"><h2 class="text-xl font-bold section-heading mb-4">Admin Login</h2><div class="mb-4"><label for="adminPassword" class="block text-sm font-medium">Password</label><input type="password" id="adminPassword" class="mt-1 block w-full border-slate-300 dark:border-slate-600 dark:bg-slate-700 rounded-md p-2"><p id="loginError" class="text-red-500 text-sm mt-2 hidden">Incorrect password.</p></div><div class="flex justify-end gap-4"><button type="button" id="cancelLoginBtn" class="bg-slate-300 font-bold py-2 px-4 rounded-lg">Cancel</button><button type="button" id="submitLoginBtn" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-lg">Login</button></div></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ADMIN_PASSWORD = "contentcowboy123";
            const { firebaseDb: db, firebaseAuth: auth, firebaseAppId: appId, firebaseDoc: doc, firebaseDeleteDoc: deleteDoc, firebaseOnSnapshot: onSnapshot, firebaseCollection: collection, firebaseAddDoc: addDoc, firebaseSetDoc: setDoc, firebaseSignInAnonymously: signInAnonymously, firebaseOnAuthStateChanged: onAuthStateChanged } = window;
            
            let posts = [], weeklyTitles = {}, currentUserId = null, isAdminLoggedIn = false;
            let globalPreferences = { platformFilter: 'All Platforms', statusFilter: 'All Statuses', weekStartDay: 'Monday' };
            let currentWeekStartDate = getWeekStartDate(new Date(), globalPreferences.weekStartDay);
            let platformChart, statusChart, postIdToDelete = null;

            const ui = { platformFilter: document.getElementById('platformFilter'), statusFilter: document.getElementById('statusFilter'), weekStartDayFilter: document.getElementById('weekStartDayFilter'), darkModeToggle: document.getElementById('darkModeToggle'), currentWeekDisplay: document.getElementById('currentWeekDisplay'), weeklyTitleDisplay: document.getElementById('weeklyTitleDisplay'), editWeeklyTitleBtn: document.getElementById('editWeeklyTitleBtn'), currentWeekGrid: document.getElementById('current-week-grid'), postedDailyGrid: document.getElementById('posted-daily-grid'), allPostedContentContainer: document.getElementById('all-posted-content-container'), addPostBtn: document.getElementById('addPostBtn'), loggedInUserDisplay: document.getElementById('loggedInUserDisplay'), currentUserIdDisplay: document.getElementById('currentUserIdDisplay'), adminLoginBtn: document.getElementById('adminLoginBtn'), adminLogoutBtn: document.getElementById('adminLogoutBtn'), postModal: document.getElementById('postModal'), postForm: document.getElementById('postForm'), modalTitle: document.getElementById('modalTitle'), cancelBtn: document.getElementById('cancelBtn'), deleteConfirmModal: document.getElementById('deleteConfirmModal'), confirmDeleteBtn: document.getElementById('confirmDeleteBtn'), cancelDeleteBtn: document.getElementById('cancelDeleteBtn'), loginModal: document.getElementById('loginModal'), submitLoginBtn: document.getElementById('submitLoginBtn'), cancelLoginBtn: document.getElementById('cancelLoginBtn'), adminPasswordInput: document.getElementById('adminPassword'), loginError: document.getElementById('loginError'), prevWeekBtn: document.getElementById('prevWeekBtn'), nextWeekBtn: document.getElementById('nextWeekBtn'), statusChartTitle: document.getElementById('statusChartTitle'), trashSection: document.getElementById('trash-section'), trashContainer: document.getElementById('trash-container'), permanentDeleteConfirmModal: document.getElementById('permanentDeleteConfirmModal'), cancelPermanentDeleteBtn: document.getElementById('cancelPermanentDeleteBtn'), confirmPermanentDeleteBtn: document.getElementById('confirmPermanentDeleteBtn') };
            const platformColors = {'Facebook': '#1877F2', 'Instagram': '#E4405F', 'TikTok': '#000000', 'Blog': '#FF5722', 'LinkedIn': '#0A66C2', 'X': '#000000', 'Behance': '#0057FF', 'YouTube': '#FF0000', 'default': '#64748b'};

            function getWeekStartDate(d, startDayName) { d = new Date(d); d.setHours(0, 0, 0, 0); const day = d.getDay(); const diff = (startDayName === 'Monday') ? d.getDate() - day + (day === 0 ? -6 : 1) : d.getDate() - day; return new Date(new Date(d.setDate(diff)).setHours(0, 0, 0, 0)); }
            
            function isPostInWeek(post, weekStart, weekEnd) {
                if (!post.publishDate || typeof post.publishDate !== 'string' || !post.publishDate.includes('-')) return false;
                const parts = post.publishDate.split('-');
                if (parts.length !== 3) return false;
                const d = new Date(Date.UTC(parts[0], parts[1] - 1, parts[2]));
                return d instanceof Date && !isNaN(d) && d >= weekStart && d < weekEnd;
            }

            function createPostCard(post, isTrashView = false) { const card = document.createElement('div'); card.className = 'bg-white/70 dark:bg-slate-900/70 backdrop-blur-sm p-2.5 rounded-lg shadow-md hover:shadow-lg transition-shadow relative space-y-2'; const platforms = post.platforms || []; const status = post.status || 'Unknown'; const platformsHtml = platforms.map(p => `<span class="platform-tag bg-${p.toLowerCase()}">${p}</span>`).join(''); const viewPostButton = (post.outputLink && status === 'Posted') ? `<a href="${post.outputLink}" target="_blank" rel="noopener noreferrer" class="text-xs bg-blue-500 text-white px-2 py-1 rounded-full hover:bg-blue-600">View Post</a>` : ''; const deleteButtonHtml = isAdminLoggedIn && !isTrashView ? `<button class="absolute top-1 right-1 text-slate-400 hover:text-red-500 delete-post-btn"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 pointer-events-none" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 10002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg></button>` : ''; const trashButtonsHtml = isTrashView ? `<div class="flex justify-end gap-2 mt-2"><button data-id="${post.id}" class="restore-post-btn text-xs bg-green-500 text-white px-2 py-1 rounded-full hover:bg-green-600">Restore</button><button data-id="${post.id}" class="permanent-delete-btn text-xs bg-red-600 text-white px-2 py-1 rounded-full hover:bg-red-700">Delete Forever</button></div>` : ''; card.innerHTML = `<h4 class="font-bold text-sm section-heading truncate">${post.topic || 'Untitled Post'}</h4><div class="flex flex-wrap gap-1">${platformsHtml}</div><p class="text-xs text-slate-600"><strong>Type:</strong> ${post.type || 'N/A'}</p><div class="flex justify-between items-center"><span class="status-tag bg-${status.replace(/\s+/g, '-').toLowerCase()}-200 text-${status.replace(/\s+/g, '-').toLowerCase()}-800">${status}</span>${viewPostButton}</div>${deleteButtonHtml}${trashButtonsHtml}`; if (!isTrashView) { card.addEventListener('click', (e) => { if (e.target.closest('.delete-post-btn') || e.target.closest('a')) return; isAdminLoggedIn ? openModal(post) : showLoginModal(); }); } if (isAdminLoggedIn && !isTrashView) { card.querySelector('.delete-post-btn')?.addEventListener('click', (e) => { e.stopPropagation(); showDeleteConfirm(post.id); }); } return card; }
            function populateFilters() { const activePosts = posts.filter(p => !p.isTrashed); const allPlatforms = new Set(activePosts.flatMap(p => p.platforms || [])); const currentFilterValue = ui.platformFilter.value; ui.platformFilter.innerHTML = '<option>All Platforms</option>'; Array.from(allPlatforms).sort().forEach(platform => { const option = document.createElement('option'); option.value = platform; option.textContent = platform; ui.platformFilter.appendChild(option); }); ui.platformFilter.value = currentFilterValue; }

            function renderAllContent() {
                const weekStart = currentWeekStartDate;
                const weekEnd = new Date(new Date(weekStart).setDate(weekStart.getDate() + 7));
                const weekId = weekStart.toISOString().split('T')[0];
                
                const activePostsInWeek = posts.filter(p => !p.isTrashed && isPostInWeek(p, weekStart, weekEnd));
                
                const postsForCharts = (globalPreferences.platformFilter === 'All Platforms') ? activePostsInWeek : activePostsInWeek.filter(p => p.platforms && p.platforms.includes(globalPreferences.platformFilter));
                const filteredWeeklyPosts = activePostsInWeek.filter(p => (globalPreferences.platformFilter === 'All Platforms' || (p.platforms && p.platforms.includes(globalPreferences.platformFilter))) && (globalPreferences.statusFilter === 'All Statuses' || p.status === globalPreferences.statusFilter));
                const postedThisWeek = activePostsInWeek.filter(p => p.status === 'Posted' && (globalPreferences.platformFilter === 'All Platforms' || (p.platforms && p.platforms.includes(globalPreferences.platformFilter))));
                
                const orderedDays = (globalPreferences.weekStartDay === 'Monday') ? ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                
                ui.currentWeekDisplay.textContent = `${weekStart.toLocaleDateString()} - ${new Date(new Date(weekStart).setDate(weekStart.getDate() + 6)).toLocaleDateString()}`;
                const currentTitle = weeklyTitles[weekId];
                ui.weeklyTitleDisplay.textContent = currentTitle || '';
                ui.editWeeklyTitleBtn.textContent = currentTitle ? '[Edit Title]' : '[Add Title]';
                ui.editWeeklyTitleBtn.classList.toggle('hidden', !isAdminLoggedIn);
                
                ['currentWeekGrid', 'postedDailyGrid', 'allPostedContentContainer', 'trashContainer'].forEach(id => ui[id] && (ui[id].innerHTML = ''));

                for (let i = 0; i < 7; i++) {
                    const dayCol = document.createElement('div');
                    dayCol.className = 'day-column rounded-lg p-2 space-y-2';
                    dayCol.innerHTML = `<h3 class="font-bold text-base text-center section-heading mb-2">${orderedDays[i]}</h3>`;
                    ui.currentWeekGrid.appendChild(dayCol);
                    ui.postedDailyGrid.appendChild(dayCol.cloneNode(true));
                }
                
                filteredWeeklyPosts.forEach(post => { const parts = post.publishDate.split('-'); const pDate = new Date(Date.UTC(parts[0], parts[1] - 1, parts[2])); let dayIndex = pDate.getUTCDay(); if (globalPreferences.weekStartDay === 'Monday') dayIndex = (dayIndex === 0) ? 6 : dayIndex - 1; const grid = post.status === 'Posted' ? ui.postedDailyGrid : ui.currentWeekGrid; if (grid.children[dayIndex]) grid.children[dayIndex].appendChild(createPostCard(post)); });
                postedThisWeek.forEach(post => ui.allPostedContentContainer.appendChild(createPostCard(post)));
                
                ui.trashSection.classList.toggle('hidden', !isAdminLoggedIn);
                if (isAdminLoggedIn) {
                    const trashedPostsInWeek = posts.filter(p => p.isTrashed && isPostInWeek(p, weekStart, weekEnd));
                    trashedPostsInWeek.forEach(post => ui.trashContainer.appendChild(createPostCard(post, true)));
                }

                renderCharts(postsForCharts);
                updateAdminUI();
            }

            function renderCharts(data) { const isDarkMode = document.documentElement.classList.contains('dark'); const chartColors = { text: isDarkMode ? '#e5e7eb' : '#475569', border: isDarkMode ? '#475569' : '#e2e8f0' }; const selectedPlatform = globalPreferences.platformFilter; const platformCounts = {}; (selectedPlatform === 'All Platforms' ? data : data.filter(p => p.platforms.includes(selectedPlatform))).forEach(post => (post.platforms || []).forEach(p => platformCounts[p] = (platformCounts[p] || 0) + 1)); if(platformChart) platformChart.destroy(); platformChart = new Chart('platformChart', { type: 'doughnut', data: { labels: Object.keys(platformCounts), datasets: [{ data: Object.values(platformCounts), backgroundColor: Object.keys(platformCounts).map(p => platformColors[p] || platformColors.default) }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: chartColors.text } } } } }); const statuses = ['To Do', 'In Progress', 'For Approval', 'Scheduled', 'Posted']; if(statusChart) statusChart.destroy(); if (selectedPlatform === 'All Platforms') { ui.statusChartTitle.textContent = 'Content Status by Platform'; const platformsInData = [...new Set(data.flatMap(p => p.platforms || []))].sort(); const statusDatasets = platformsInData.map(platform => ({ label: platform, data: statuses.map(status => data.filter(post => post.status === status && (post.platforms || []).includes(platform)).length), backgroundColor: platformColors[platform] || platformColors.default })); statusChart = new Chart('statusChart', { type: 'bar', data: { labels: statuses, datasets: statusDatasets }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: chartColors.text } } }, scales: { x: { stacked: true, ticks: {color: chartColors.text}, grid:{color:chartColors.border} }, y: { stacked: true, ticks: {color: chartColors.text}, grid:{color:chartColors.border} } } } }); } else { ui.statusChartTitle.textContent = `Content Status for ${selectedPlatform}`; const statusCounts = {'To Do':0, 'In Progress':0, 'For Approval':0, 'Scheduled':0, 'Posted':0}; data.forEach(post => { if(statusCounts.hasOwnProperty(post.status)) statusCounts[post.status]++; }); const singleDataset = [{ label: selectedPlatform, data: Object.values(statusCounts), backgroundColor: platformColors[selectedPlatform] || platformColors.default }]; statusChart = new Chart('statusChart', { type: 'bar', data: { labels: statuses, datasets: singleDataset }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { ticks: {color: chartColors.text}, grid:{color:chartColors.border} }, y: { ticks: {color: chartColors.text}, grid:{color:chartColors.border} } } } }); } }

            onAuthStateChanged(auth, user => { if (user) { currentUserId = user.uid; ui.currentUserIdDisplay.textContent = `UID: ${user.uid.slice(0, 6)}...`; onSnapshot(collection(db, `artifacts/${appId}/public/data/posts`), snap => { posts = snap.docs.map(d => ({ id: d.id, ...d.data() })); populateFilters(); renderAllContent(); }, (error) => { console.error("Error fetching posts:", error); alert("Could not load posts."); }); onSnapshot(collection(db, `artifacts/${appId}/public/data/weekly_titles`), snap => { weeklyTitles = {}; snap.docs.forEach(d => { weeklyTitles[d.id] = d.data().title; }); renderAllContent(); }, (error) => console.error("Error fetching weekly titles:", error) ); } else { signInAnonymously(auth).catch(e => console.error("Anonymous sign-in failed", e)); } });
            
            function openModal(post = null) {
                ui.postForm.reset();
                document.getElementById('postId').value = post?.id || '';
                ui.modalTitle.textContent = post ? 'Edit Content' : 'Add New Content';
                document.getElementById('contentTopic').value = post?.topic || '';
                document.getElementById('publishDate').value = post?.publishDate || new Date().toISOString().split('T')[0];
                document.getElementById('status').value = post?.status || 'To Do';
                document.getElementById('platforms').value = post?.platforms?.join(', ') || '';
                document.getElementById('contentType').value = post?.type || '';
                document.getElementById('resources').value = post?.resources || '';
                document.getElementById('notes').value = post?.notes || '';
                document.getElementById('outputLink').value = post?.outputLink || '';
                ui.postModal.classList.remove('hidden');
                ui.postModal.classList.add('flex');
            }

            function closeModal() { ui.postModal.classList.add('hidden'); }
            function showDeleteConfirm(id) { postIdToDelete = id; ui.deleteConfirmModal.classList.remove('hidden'); ui.deleteConfirmModal.classList.add('flex'); }
            function hideDeleteConfirm() { ui.deleteConfirmModal.classList.add('hidden'); }
            async function deletePost() { if(!postIdToDelete) return; await setDoc(doc(db, `artifacts/${appId}/public/data/posts`, postIdToDelete), { isTrashed: true }, { merge: true }); hideDeleteConfirm(); }
            function showPermanentDeleteConfirm(id) { postIdToDelete = id; ui.permanentDeleteConfirmModal.classList.remove('hidden'); ui.permanentDeleteConfirmModal.classList.add('flex'); }
            function hidePermanentDeleteConfirm() { ui.permanentDeleteConfirmModal.classList.add('hidden'); }
            async function permanentlyDeletePost() { if(!postIdToDelete) return; await deleteDoc(doc(db,`artifacts/${appId}/public/data/posts`, postIdToDelete)); hidePermanentDeleteConfirm(); }
            async function restorePost(id) { if(!id) return; await setDoc(doc(db, `artifacts/${appId}/public/data/posts`, id), { isTrashed: false }, { merge: true }); }
            function showLoginModal() { ui.adminPasswordInput.value = ''; ui.loginError.classList.add('hidden'); ui.loginModal.classList.remove('hidden'); ui.loginModal.classList.add('flex'); }
            function hideLoginModal() { ui.loginModal.classList.add('hidden'); }
            function login() { if (ui.adminPasswordInput.value === ADMIN_PASSWORD) { isAdminLoggedIn = true; localStorage.setItem('isAdminLoggedIn', 'true'); hideLoginModal(); renderAllContent(); } else { ui.loginError.classList.remove('hidden'); } }
            function logout() { isAdminLoggedIn = false; localStorage.removeItem('isAdminLoggedIn'); renderAllContent(); }
            function updateAdminUI() { ui.addPostBtn.disabled = !isAdminLoggedIn; ui.addPostBtn.classList.toggle('opacity-50', !isAdminLoggedIn); ui.adminLoginBtn.classList.toggle('hidden', isAdminLoggedIn); ui.adminLogoutBtn.classList.toggle('hidden', !isAdminLoggedIn); ui.loggedInUserDisplay.textContent = isAdminLoggedIn ? 'Logged in as Admin' : 'Not Logged In'; }
            
            async function handleFormSubmit(e) {
                e.preventDefault();
                const id = document.getElementById('postId').value;
                const postData = {
                    topic: document.getElementById('contentTopic').value,
                    publishDate: document.getElementById('publishDate').value,
                    status: document.getElementById('status').value,
                    platforms: document.getElementById('platforms').value.split(',').map(p=>p.trim()).filter(Boolean),
                    type: document.getElementById('contentType').value,
                    resources: document.getElementById('resources').value,
                    notes: document.getElementById('notes').value,
                    outputLink: document.getElementById('outputLink').value,
                    isTrashed: false // Ensure posts created/edited are not in trash
                };
                try {
                    if (id) {
                        await setDoc(doc(db, `artifacts/${appId}/public/data/posts`, id), postData, { merge: true });
                    } else {
                        await addDoc(collection(db, `artifacts/${appId}/public/data/posts`), postData);
                    }
                    closeModal();
                } catch (err) {
                    console.error("Error saving post:", err);
                }
            }
            
            async function handleEditWeeklyTitle() {
                if (!isAdminLoggedIn) return;
                const weekId = currentWeekStartDate.toISOString().split('T')[0];
                const currentTitle = weeklyTitles[weekId] || '';
                const newTitle = window.prompt("Enter the title for this week:", currentTitle);

                if (newTitle === null) return; // User clicked cancel

                const titleRef = doc(db, `artifacts/${appId}/public/data/weekly_titles`, weekId);
                if (newTitle.trim() === '') {
                    if (currentTitle) await deleteDoc(titleRef);
                } else {
                    await setDoc(titleRef, { title: newTitle });
                }
            }

            (function setupEventListeners() {
                ui.platformFilter.addEventListener('change', e => { globalPreferences.platformFilter = e.target.value; renderAllContent(); });
                ui.statusFilter.addEventListener('change', e => { globalPreferences.statusFilter = e.target.value; renderAllContent(); });
                ui.weekStartDayFilter.addEventListener('change', e => { globalPreferences.weekStartDay = e.target.value; currentWeekStartDate = getWeekStartDate(currentWeekStartDate, e.target.value); renderAllContent(); });
                ui.darkModeToggle.addEventListener('change', () => { const isDark = document.documentElement.classList.toggle('dark'); localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled'); renderAllContent(); });
                ui.addPostBtn.addEventListener('click', () => isAdminLoggedIn ? openModal() : showLoginModal());
                ui.cancelBtn.addEventListener('click', closeModal);
                ui.postForm.addEventListener('submit', handleFormSubmit);
                ui.prevWeekBtn.addEventListener('click', () => { currentWeekStartDate.setDate(currentWeekStartDate.getDate() - 7); renderAllContent(); });
                ui.nextWeekBtn.addEventListener('click', () => { currentWeekStartDate.setDate(currentWeekStartDate.getDate() + 7); renderAllContent(); });
                ui.adminLoginBtn.addEventListener('click', showLoginModal);
                ui.adminLogoutBtn.addEventListener('click', logout);
                ui.submitLoginBtn.addEventListener('click', login);
                ui.cancelLoginBtn.addEventListener('click', hideLoginModal);
                ui.confirmDeleteBtn.addEventListener('click', deletePost);
                ui.cancelDeleteBtn.addEventListener('click', hideDeleteConfirm);
                ui.editWeeklyTitleBtn.addEventListener('click', handleEditWeeklyTitle);
                
                // New listeners for trash system
                ui.confirmPermanentDeleteBtn.addEventListener('click', permanentlyDeletePost);
                ui.cancelPermanentDeleteBtn.addEventListener('click', hidePermanentDeleteConfirm);
                ui.trashContainer.addEventListener('click', e => {
                    const restoreBtn = e.target.closest('.restore-post-btn');
                    if (restoreBtn) {
                        restorePost(restoreBtn.dataset.id);
                    }
                    const permanentDeleteBtn = e.target.closest('.permanent-delete-btn');
                    if (permanentDeleteBtn) {
                        showPermanentDeleteConfirm(permanentDeleteBtn.dataset.id);
                    }
                });

                [ui.postModal, ui.deleteConfirmModal, ui.loginModal, ui.permanentDeleteConfirmModal].forEach(modal => modal.addEventListener('click', e => { if (e.target === modal) e.currentTarget.classList.add('hidden'); }));
            })();

            if (localStorage.getItem('darkMode') === 'enabled') { document.documentElement.classList.add('dark'); ui.darkModeToggle.checked = true; }
            if (localStorage.getItem('isAdminLoggedIn') === 'true') { isAdminLoggedIn = true; }
            updateAdminUI();
        });
    </script>
</body>
</html>
