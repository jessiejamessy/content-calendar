<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Cowboy Interactive Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Slackey&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* Slightly darker light background for better contrast */
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            /* Responsive height handled by Tailwind classes on the div itself */
        }
        .day-column {
            min-height: 250px; /* Reduced height for two weeks to fit better */
        }
        .modal-bg {
            background-color: rgba(0,0,0,0.5);
        }

        /* Custom Brand Colors - Light Mode */
        .text-brand-charcoal { color: #333333; }
        .bg-brand-charcoal { background-color: #333333; }
        .text-brand-soft-blue { color: #ADD8E6; }
        .bg-brand-soft-blue { background-color: #ADD8E6; }
        .text-brand-coral { color: #FF7F50; }
        .bg-brand-coral { background-color: #FF7F50; }

        /* Dark Mode Styles */
        .dark {
            background-color: #1a202c; /* Dark background for body */
            color: #e2e8f0; /* Light text for body */
        }
        .dark .text-slate-800 { color: #e2e8f0; }
        .dark .text-slate-600 { color: #cbd5e1; } /* Light gray for secondary text */
        .dark .bg-white { background-color: #2d3748; } /* Darker background for cards/sections */
        .dark .bg-slate-200 { /* For platform tags */
            background-color: #4a5568; /* Darker gray */
            color: #e2e8f0;
        }
        /* Day column background in dark mode */
        .dark .day-column {
            background-color: #2d3748; /* Darker background for day columns */
        }
        /* Dark mode custom brand colors override */
        .dark .text-brand-charcoal { color: #e2e8f0; }
        .dark .bg-brand-charcoal { background-color: #1f2937; }
        .dark .text-brand-soft-blue { color: #94a3b8; }
        .dark .bg-brand-soft-blue { background-color: #334155; }
        .dark .text-brand-coral { color: #fca5a5; }
        .dark .bg-brand-coral { background-color: #be123c; }

        /* Status colors in dark mode - keep them distinct but adjust for dark background */
        .dark .bg-rose-200 { background-color: #991b1b; } /* Darker rose */
        .dark .text-rose-800 { color: #fecaca; } /* Lighter rose text */
        .dark .bg-amber-200 { background-color: #92400e; } /* Darker amber */
        .dark .text-amber-800 { color: #fcd34d; } /* Lighter amber text */
        .dark .bg-sky-200 { background-color: #0c4a6e; } /* Darker sky */
        .dark .text-sky-800 { color: #bae6fd; } /* Lighter sky text */
        .dark .bg-emerald-200 { background-color: #065f46; } /* Darker emerald for 'Posted' */
        .dark .text-emerald-800 { color: #a7f3d0; } /* Lighter emerald text for 'Posted' */
        /* New status color for Approval */
        .bg-violet-200 { background-color: #e0cffc; } /* Light violet */
        .text-violet-800 { color: #5b21b6; } /* Dark violet text */
        .dark .bg-violet-200 { background-color: #6d28d9; } /* Darker violet for dark mode */
        .dark .text-violet-800 { color: #d8b4fe; } /* Lighter violet text for dark mode */

        /* Platform specific colors */
        .bg-facebook { background-color: #1877F2; }
        .text-facebook { color: #FFFFFF; }
        .bg-instagram { background-color: #E4405F; }
        .text-instagram { color: #FFFFFF; }
        .bg-tiktok { background-color: #000000; }
        .text-tiktok { color: #FFFFFF; }
        .bg-blog { background-color: #FF5722; } /* Orange for Blog */
        .text-blog { color: #FFFFFF; }
        .bg-linkedin { background-color: #0A66C2; }
        .text-linkedin { color: #FFFFFF; }
        .bg-x { background-color: #000000; } /* Black for X (Twitter) */
        .text-x { color: #FFFFFF; }
        .bg-behance { background-color: #0057FF; } /* Blue for Behance */
        .text-behance { color: #FFFFFF; }
        .bg-youtube { background-color: #FF0000; } /* Red for YouTube */
        .text-youtube { color: #FFFFFF; }

        /* Dark mode platform colors - adjust for better visibility */
        .dark .bg-facebook { background-color: #3b5998; }
        .dark .bg-instagram { background-color: #C13584; }
        .dark .bg-tiktok { background-color: #222222; }
        .dark .bg-blog { background-color: #D32F2F; }
        .dark .bg-linkedin { background-color: #0E76A8; }
        .dark .bg-x { background-color: #222222; }
        .dark .bg-behance { background-color: #3C69E7; }
        .dark .bg-youtube { background-color: #CC0000; }


        /* Dark mode toggle switch dot position */
        #darkModeToggle:checked + div .dot {
            transform: translateX(20px);
        }

        /* Light Mode Day Column Backgrounds */
        .day-column.light-mode-weekday {
            background-color: #e0f2fe; /* A specific light blue for weekdays */
        }
        .day-column.light-mode-weekend {
            background-color: #e0f7fa; /* A slightly different light blue for weekends */
        }

        /* Updated: Western Font for Main Title - Using 'Slackey' */
        .western-font {
            font-family: 'Slackey', cursive, sans-serif; /* Applied new font with fallbacks */
            text-shadow: 2px 2px 3px rgba(0,0,0,0.4); /* Added a subtle shadow for pop */
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-brand-charcoal western-font">Content Cowboy Interactive Calendar</h1>
            <p class="text-slate-600 mt-2 text-base md:text-lg">A dynamic view of your weekly content schedule.</p>
        </header>

        <div class="bg-white p-4 rounded-xl shadow-sm mb-8 sticky top-4 z-10">
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-center">
                <div class="md:col-span-1">
                    <h2 class="font-bold text-lg md:text-xl text-brand-charcoal">Filter Controls</h2>
                </div>
                <div class="md:col-span-1">
                    <label for="platformFilter" class="block text-sm font-medium text-brand-charcoal">Platform</label>
                    <select id="platformFilter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-brand-soft-blue focus:border-brand-soft-blue sm:text-sm dark:bg-slate-800 dark:text-white dark:border-gray-600">
                        <option>All Platforms</option>
                    </select>
                </div>
                <div class="md:col-span-1">
                    <label for="statusFilter" class="block text-sm font-medium text-brand-charcoal">Status</label>
                    <select id="statusFilter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-brand-soft-blue focus:border-brand-soft-blue sm:text-sm dark:bg-slate-800 dark:text-white dark:border-gray-600">
                        <option>All Statuses</option>
                        <option>To Do</option>
                        <option>In Progress</option>
                        <option>For Approval</option>
                        <option>Scheduled</option>
                        <option>Posted</option>
                    </select>
                </div>
                <div class="md:col-span-1">
                    <label for="weekStartDayFilter" class="block text-sm font-medium text-brand-charcoal">Week Starts On</label>
                    <select id="weekStartDayFilter" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-brand-soft-blue focus:border-brand-soft-blue sm:text-sm dark:bg-slate-800 dark:text-white dark:border-gray-600">
                        <option value="Monday">Monday</option>
                        <option value="Sunday">Sunday</option>
                    </select>
                </div>
                <div class="md:col-span-1 text-right order-first md:order-none flex flex-col items-end gap-2">
                    <button id="addPostBtn" class="w-full md:w-auto bg-brand-coral hover:bg-coral-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105">
                        Add New Post
                    </button>
                    <div id="adminControls" class="flex flex-col md:flex-row gap-2 w-full md:w-auto">
                        <button id="adminLoginBtn" class="w-full md:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105">
                            Admin Login
                        </button>
                        <button id="adminLogoutBtn" class="w-full md:w-auto bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105 hidden">
                            Logout
                        </button>
                    </div>
                </div>
                <div class="md:col-span-1 flex justify-center md:justify-end items-center">
                    <label for="darkModeToggle" class="flex items-center cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="darkModeToggle" class="sr-only">
                            <div class="block bg-slate-600 w-14 h-8 rounded-full"></div>
                            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
                        </div>
                        <div class="ml-3 text-brand-charcoal font-medium">Dark Mode</div>
                    </label>
                </div>
                <div class="md:col-span-4 flex items-center justify-end">
                    <span id="loggedInUserDisplay" class="text-sm font-medium text-slate-600 dark:text-slate-400">Not Logged In</span>
                </div>
            </div>
             <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
                <button id="exportDataBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105">
                    Export Data
                </button>
                <input type="file" id="importFileInput" accept=".json" class="hidden">
                <button id="importDataBtn" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg shadow transition-transform transform hover:scale-105">
                    Import Data
                </button>
            </div>
        </div>

        <section id="week-navigation" class="bg-white p-4 rounded-xl shadow-sm mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
            <button id="prevWeekBtn" class="bg-brand-soft-blue hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">
                &larr; Previous Week
            </button>
            <div class="text-lg md:text-xl font-semibold text-brand-charcoal" id="currentWeekDisplay"></div>
            <button id="nextWeekBtn" class="bg-brand-soft-blue hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">
                Next Week &rarr;
            </button>
        </section>

        <section id="weekly-title-control" class="bg-white p-4 rounded-xl shadow-sm mb-8">
            <h2 class="font-bold text-lg md:text-xl text-brand-charcoal mb-4">Customize Weekly Titles</h2>
            <div class="flex flex-col sm:flex-row gap-4 items-center">
                <input type="text" id="customWeeklyTitleInput" placeholder="Enter custom weekly title (e.g., Q3 Planning)"
                        class="flex-grow mt-1 block w-full sm:w-auto border border-slate-300 rounded-md shadow-sm p-2
                                focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600">
                <button id="setCustomTitleBtn" class="w-full sm:w-auto bg-brand-soft-blue hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">
                    Set Custom Title
                </button>
                <button id="clearCustomTitleBtn" class="w-full sm:w-auto bg-slate-300 hover:bg-slate-400 text-slate-800 font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">
                    Clear Custom Title
                </button>
            </div>
        </section>
        <section id="analytics" class="mb-8">
            <h2 class="text-2xl md:text-3xl font-bold text-brand-charcoal mb-4 text-center">Analytics Overview</h2>
            <p class="text-slate-600 text-center mb-6 text-base md:text-lg">This section provides a high-level summary of your content plan. The charts below are fully dynamic and will update automatically as you add, edit, or filter your content in the calendar grid, giving you immediate visual feedback on your strategy.</p>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-lg md:text-xl font-semibold text-center text-brand-charcoal mb-4">Content Distribution by Platform</h3>
                    <div class="chart-container h-[300px] sm:h-[350px]">
                        <canvas id="platformChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-sm">
                    <h3 class="text-lg md:text-xl font-semibold text-center text-brand-charcoal mb-4">Content Status</h3>
                    <div class="chart-container h-[300px] sm:h-[350px]">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <main id="calendar">
            <h2 class="text-2xl md:text-3xl font-bold text-brand-charcoal mb-2 text-center">Current Week Content</h2>
            <p class="text-slate-600 text-center mb-2 text-sm md:text-base" id="current-week-planned-title"></p>
            <p class="text-slate-600 text-center mb-6 text-base md:text-lg">This is your main workspace for the current week's planned content (To Do, In Progress, Scheduled, For Approval).</p>
            <div id="current-week-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-4">
                </div>
        </main>

        <section id="posted-daily-calendar" class="mt-8">
            <h2 class="text-2xl md:text-3xl font-bold text-brand-charcoal mb-2 text-center">Posted Content by Day</h2>
            <p class="text-slate-600 text-center mb-2 text-sm md:text-base" id="current-week-posted-title"></p>
            <p class="text-slate-600 text-center mb-6 text-base md:text-lg">View posted content for each day of the current week.</p>
            <div id="posted-daily-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-7 gap-4">
                </div>
        </section>

        <section id="all-posted-content-section" class="mt-8">
            <h2 class="text-2xl md:text-3xl font-bold text-brand-charcoal mb-4 text-center">All Posted Content (Archive)</h2>
            <p class="text-slate-600 text-center mb-6 text-base md:text-lg">A consolidated view of all your published posts across all weeks. This section always shows all posted content.</p>
            <div id="all-posted-content-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                </div>
        </section>
    </div>

    <div id="postModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-lg transform transition-all" id="modal-content">
            <h2 id="modalTitle" class="text-2xl font-bold mb-6 text-brand-charcoal">Add New Content</h2>
            <form id="postForm">
                <input type="hidden" id="postId">
                <div class="mb-4">
                    <label for="contentTopic" class="block text-sm font-medium text-brand-charcoal">Content Topic</label>
                    <input type="text" id="contentTopic" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600" required>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="publishDate" class="block text-sm font-medium text-brand-charcoal">Publish Date</label>
                        <input type="date" id="publishDate" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600" required>
                    </div>
                    <div>
                        <label for="status" class="block text-sm font-medium text-brand-charcoal">Status</label>
                        <select id="status" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600">
                            <option>To Do</option>
                            <option>In Progress</option>
                            <option>For Approval</option>
                            <option>Scheduled</option>
                            <option>Posted</option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="platforms" class="block text-sm font-medium text-brand-charcoal">Platforms (comma-separated)</label>
                    <input type="text" id="platforms" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600" placeholder="e.g., Facebook, Instagram" required>
                </div>
                <div class="mb-4">
                    <label for="contentType" class="block text-sm font-medium text-brand-charcoal">Content Type</label>
                    <input type="text" id="contentType" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600" placeholder="e.g., Reel, Post" required>
                </div>
                <div class="mb-4">
                    <label for="resources" class="block text-sm font-medium text-brand-charcoal">Resources (link or notes)</label>
                    <input type="text" id="resources" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600" placeholder="e.g., Google Drive link, design assets folder">
                </div>
                <div class="mb-6">
                    <label for="outputLink" class="block text-sm font-medium text-brand-charcoal">Output Link (published content URL)</label>
                    <input type="url" id="outputLink" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600" placeholder="e.g., https://instagram.com/your-post-url">
                </div>
                <div class="mb-6">
                    <label for="notes" class="block text-sm font-medium text-brand-charcoal">Notes</label>
                    <textarea id="notes" rows="3" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600"></textarea>
                </div>
                <div class="flex justify-end gap-4">
                    <button type="button" id="cancelBtn" class="bg-slate-200 hover:bg-slate-300 text-slate-800 font-bold py-2 px-4 rounded-lg">Cancel</button>
                    <button type="submit" id="saveBtn" class="bg-brand-soft-blue hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg">Save Post</button>
                </div>
            </form>
        </div>
    </div>

    <div id="deleteConfirmModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-sm transform transition-all" id="delete-modal-content">
            <h2 class="text-xl font-bold mb-4 text-brand-charcoal">Confirm Deletion</h2>
            <p class="text-slate-600 mb-6">Are you sure you want to delete this post? This action cannot be undone.</p>
            <div class="flex justify-end gap-4">
                <button type="button" id="cancelDeleteBtn" class="bg-slate-200 hover:bg-slate-300 text-slate-800 font-bold py-2 px-4 rounded-lg">Cancel</button>
                <button type="button" id="confirmDeleteBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Delete</button>
            </div>
        </div>
    </div>

    <div id="loginModal" class="fixed inset-0 modal-bg z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl p-8 w-full max-w-sm transform transition-all" id="login-modal-content">
            <h2 class="text-xl font-bold mb-4 text-brand-charcoal">Admin Login</h2>
            <p class="text-slate-600 mb-4">Enter admin password to enable editing features.</p>
            <div class="mb-4">
                <label for="adminPassword" class="block text-sm font-medium text-brand-charcoal">Password</label>
                <input type="password" id="adminPassword" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm p-2 focus:ring-brand-soft-blue focus:border-brand-soft-blue dark:bg-slate-800 dark:text-white dark:border-gray-600">
                <p id="loginError" class="text-red-500 text-sm mt-2 hidden">Incorrect password. Please try again.</p>
            </div>
            <div class="flex justify-end gap-4">
                <button type="button" id="cancelLoginBtn" class="bg-slate-200 hover:bg-slate-300 text-slate-800 font-bold py-2 px-4 rounded-lg">Cancel</button>
                <button type="button" id="submitLoginBtn" class="bg-brand-soft-blue hover:bg-sky-700 text-white font-bold py-2 px-4 rounded-lg">Login</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Admin password (for client-side demo purposes only - NOT secure for production)
            const ADMIN_PASSWORD = "contentcowboy123";

            // Function to load posts from Local Storage
            function loadPosts() {
                const storedPosts = localStorage.getItem('contentCowboyPosts');
                return storedPosts ? JSON.parse(storedPosts) : [
                    // Initial dummy data if no data in Local Storage
                    { id: 1, publishDate: '2025-07-14', topic: 'Intro to Content Cowboy', platforms: ['Facebook', 'Instagram', 'TikTok'], type: 'Reel, Post', status: 'Scheduled', notes: 'Short video + engaging caption', resources: 'https://drive.google.com/folder1', outputLink: 'https://facebook.com/post1' },
                    { id: 2, publishDate: '2025-07-15', topic: '3 Tips for Viral Posts', platforms: ['Blog', 'LinkedIn'], type: 'Article', status: 'In Progress', notes: 'Draft outline complete', resources: 'https://docs.google.com/article-draft', outputLink: '' },
                    { id: 3, publishDate: '2025-07-16', topic: 'Client Success Story', platforms: ['Instagram', 'Facebook'], type: 'Carousel', status: 'To Do', notes: 'Gather testimonials', resources: 'https://trello.com/board/client-story', outputLink: '' },
                    { id: 4, publishDate: '2025-07-17', topic: 'Q&A: Content Strategy', platforms: ['Facebook Live'], type: 'Live Stream', status: 'To Do', notes: 'Prepare common questions', resources: 'https://zoom.us/meeting-link', outputLink: '' },
                    { id: 5, publishDate: '2025-07-18', topic: 'Weekend Roundup', platforms: ['Facebook', 'Instagram'], type: 'Story', status: 'To Do', notes: 'Casual, interactive poll', resources: 'https://canva.com/design-template', outputLink: '' },
                    { id: 6, publishDate: '2025-07-19', topic: 'Weekend Chill Post', platforms: ['Instagram'], type: 'Photo', status: 'To Do', notes: 'Optional weekend content', resources: '', outputLink: '' },
                    { id: 7, publishDate: '2025-07-20', topic: 'Weekly Reflection', platforms: ['Facebook'], type: 'Text Post', status: 'Scheduled', notes: 'Optional weekend content', resources: '', outputLink: '' },
                    { id: 8, publishDate: '2025-07-14', topic: 'New Monday Post', platforms: ['X'], type: 'Text', status: 'Posted', notes: 'Example of a posted item', resources: '', outputLink: 'https://x.com/somepost' },
                    // Posts for the next week
                    { id: 9, publishDate: '2025-07-21', topic: 'Next Week Monday Plan', platforms: ['Blog'], type: 'Article', status: 'To Do', notes: 'Outline for next week\'s main article', resources: '', outputLink: '' },
                    { id: 10, publishDate: '2025-07-22', topic: 'Next Week Tuesday Reel', platforms: ['Instagram', 'TikTok'], type: 'Reel', status: 'In Progress', notes: 'Scripting for a short reel', resources: '', outputLink: '' },
                    { id: 11, publishDate: '2025-07-23', topic: 'Next Week Wednesday Posted', platforms: ['LinkedIn'], type: 'Post', status: 'Posted', notes: 'Pre-scheduled LinkedIn thought leadership', resources: '', outputLink: 'https://linkedin.com/post-next-week' },
                    { id: 12, publishDate: '2025-07-15', topic: 'Design Mockup Review', platforms: ['Behance'], type: 'Case Study', status: 'For Approval', notes: 'Awaiting client feedback on initial designs.', resources: 'https://behance.net/project-link', outputLink: '' } // Changed dummy post status
                ];
            }

            // Function to save posts to Local Storage
            function savePosts() {
                localStorage.setItem('contentCowboyPosts', JSON.stringify(posts));
            }

            let posts = loadPosts(); // Load posts when the page starts

            const platformFilter = document.getElementById('platformFilter');
            const statusFilter = document.getElementById('statusFilter');
            const weekStartDayFilter = document.getElementById('weekStartDayFilter'); // New filter
            const darkModeToggle = document.getElementById('darkModeToggle');
            const currentWeekDisplay = document.getElementById('currentWeekDisplay');
            const currentWeekPlannedTitle = document.getElementById('current-week-planned-title'); // New element for title
            const currentWeekPostedTitle = document.getElementById('current-week-posted-title'); // New element for title
            const prevWeekBtn = document.getElementById('prevWeekBtn');
            const nextWeekBtn = document.getElementById('nextWeekBtn');

            const customWeeklyTitleInput = document.getElementById('customWeeklyTitleInput'); // New input
            const setCustomTitleBtn = document.getElementById('setCustomTitleBtn');        // New button
            const clearCustomTitleBtn = document.getElementById('clearCustomTitleBtn');      // New button

            const exportDataBtn = document.getElementById('exportDataBtn'); // New export button
            const importDataBtn = document.getElementById('importDataBtn'); // New import button
            const importFileInput = document.getElementById('importFileInput'); // Hidden file input

            const modal = document.getElementById('postModal');
            const modalContent = document.getElementById('modal-content');
            const addPostBtn = document.getElementById('addPostBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const postForm = document.getElementById('postForm');
            const modalTitle = document.getElementById('modalTitle');
            const postIdInput = document.getElementById('postId');
            const publishDateInputModal = document.getElementById('publishDate'); // Reference to publishDate input in modal
            const platformsInputModal = document.getElementById('platforms'); // Reference to platforms input in modal
            const statusSelectModal = document.getElementById('status'); // Reference to status select in modal


            // Delete Confirmation Modal elements
            const deleteConfirmModal = document.getElementById('deleteConfirmModal');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            let postIdToDelete = null; // To store the ID of the post to be deleted

            // Admin Login Modal elements
            const loginModal = document.getElementById('loginModal');
            const adminLoginBtn = document.getElementById('adminLoginBtn');
            const adminLogoutBtn = document.getElementById('adminLogoutBtn');
            const cancelLoginBtn = document.getElementById('cancelLoginBtn');
            const submitLoginBtn = document.getElementById('submitLoginBtn');
            const adminPasswordInput = document.getElementById('adminPassword');
            const loginError = document.getElementById('loginError');
            const loggedInUserDisplay = document.getElementById('loggedInUserDisplay');

            let platformChart, statusChart;

            // Status colors are kept distinct for clarity of status
            const statusColors = {
                'To Do': 'bg-rose-200',
                'In Progress': 'bg-amber-200',
                'Scheduled': 'bg-sky-200',
                'Posted': 'bg-emerald-200',
                'For Approval': 'bg-violet-200', // New color for For Approval
            };

            const statusTextColors = {
                'To Do': 'text-rose-800',
                'In Progress': 'text-amber-800',
                'Scheduled': 'text-sky-800',
                'Posted': 'text-emerald-800',
                'For Approval': 'text-violet-800', // New text color for For Approval
            };

            // Platform specific colors
            const platformTagColors = {
                'Facebook': { bg: 'bg-facebook', text: 'text-facebook' },
                'Instagram': { bg: 'bg-instagram', text: 'text-instagram' },
                'TikTok': { bg: 'bg-tiktok', text: 'text-tiktok' },
                'Blog': { bg: 'bg-blog', text: 'text-blog' },
                'LinkedIn': { bg: 'bg-linkedin', text: 'text-linkedin' },
                'X': { bg: 'bg-x', text: 'text-x' },
                'Behance': { bg: 'bg-behance', text: 'text-behance' },
                'YouTube': { bg: 'bg-youtube', text: 'text-youtube' },
                // Default fallback if not specified
                'default': { bg: 'bg-slate-200', text: 'text-slate-700' }
            };


            // Chart colors updated to reflect brand palette
            function getChartColors(isDarkMode) {
                if (isDarkMode) {
                    return {
                        platforms: ['#94a3b8', '#fca5a5', '#e2e8f0', '#a78bfa', '#fbcfe8', '#f87171', '#c4b5fd', '#60a5fa'], // Adjusted for dark background
                        statuses: {
                            'To Do': '#fca5a5',
                            'In Progress': '#94a3b8',
                            'Scheduled': '#e2e8f0',
                            'Posted': '#a7f3d0',
                            'For Approval': '#d8b4fe' // Dark mode color for For Approval
                        }
                    };
                } else {
                    return {
                        platforms: ['#ADD8E6', '#FF7F50', '#333333', '#6366f1', '#ec4899', '#ef4444', '#8b5cf6', '#3b82f6'],
                        statuses: {
                            'To Do': '#FF7F50',
                            'In Progress': '#ADD8E6',
                            'Scheduled': '#333333',
                            'Posted': '#10b981',
                            'For Approval': '#5b21b6' // Light mode color for For Approval
                        }
                    };
                }
            }

            // Week Navigation Logic
            let preferredWeekStartDay = localStorage.getItem('weekStartDay') || 'Monday'; // Load preference, default to Monday
            weekStartDayFilter.value = preferredWeekStartDay; // Set filter dropdown to loaded preference

            let currentWeekStartDate = getWeekStartDate(new Date(), preferredWeekStartDay); // Initialize based on preference

            // Retrieve custom weekly titles from local storage
            let customWeeklyTitles = JSON.parse(localStorage.getItem('customWeeklyTitles')) || {};

            // Admin login state
            let isAdminLoggedIn = localStorage.getItem('isAdminLoggedIn') === 'true';

            function getWeekStartDate(d, startDayName) {
                d = new Date(d);
                d.setHours(0, 0, 0, 0); // Normalize to start of day
                const day = d.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
                let diff = 0;

                if (startDayName === 'Monday') {
                    diff = d.getDate() - day + (day === 0 ? -6 : 1); // Monday is 1, Sunday is 0 (needs -6)
                } else { // Sunday
                    diff = d.getDate() - day; // Sunday is 0, so subtract 0
                }
                const newDate = new Date(d.setDate(diff));
                newDate.setHours(0, 0, 0, 0); // Ensure it's at the start of the day
                return newDate;
            }

            function formatDate(date) {
                return date.toISOString().split('T')[0]; // YYYY-MM-DD
            }

            function getWeekRangeText(date) {
                const start = getWeekStartDate(new Date(date), preferredWeekStartDay);
                const end = new Date(start);
                end.setDate(start.getDate() + 6);
                const options = { month: 'long', day: 'numeric', year: 'numeric' };
                return `${start.toLocaleDateString('en-US', options)} - ${end.toLocaleDateString('en-US', options)}`;
            }

            // Function to get the current week's unique identifier (e.g., "2025-W29-MonStart")
            function getCurrentWeekId() {
                const weekStartDateFormatted = formatDate(currentWeekStartDate);
                return `${weekStartDateFormatted}-${preferredWeekStartDay}Start`;
            }

            function getOrderedDaysOfWeek(startDayName) {
                const allDays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                if (startDayName === 'Monday') {
                    return [...allDays.slice(1), allDays[0]]; // Monday to Sunday
                }
                return allDays; // Sunday to Saturday
            }

            function createPostCard(post) {
                const card = document.createElement('div');
                card.className = 'bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow relative'; // Added relative for positioning delete button
                card.dataset.id = post.id;

                const platformsHtml = post.platforms.map(p => {
                    const colors = platformTagColors[p] || platformTagColors['default'];
                    return `<span class="inline-block ${colors.bg} ${colors.text} text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">${p}</span>`;
                }).join('');

                card.innerHTML = `
                    <h4 class="font-bold text-brand-charcoal mb-2">${post.topic}</h4>
                    <div class="mb-3">${platformsHtml}</div>
                    <p class="text-sm text-slate-600 mb-3"><strong>Type:</strong> ${post.type}</p>
                    <div class="text-sm font-semibold inline-flex items-center px-3 py-1 rounded-full ${statusColors[post.status]} ${statusTextColors[post.status]}">
                        ${post.status}
                    </div>
                    ${post.resources ? `<p class="text-sm text-slate-600 mt-2"><strong>Resources:</strong> <a href="${post.resources}" target="_blank" class="text-blue-500 hover:underline">${post.resources.length > 30 ? post.resources.substring(0, 27) + '...' : post.resources}</a></p>` : ''}
                    ${post.outputLink && post.status === 'Posted' ? `<p class="text-sm mt-2"><button onclick="window.open('${post.outputLink}', '_blank')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-3 rounded-full text-xs transition-colors">View Post</button></p>` : ''}
                    ${isAdminLoggedIn ? `
                    <button class="absolute top-2 right-2 text-slate-400 hover:text-red-500 delete-post-btn" data-id="${post.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 10002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    ` : ''}
                `;
                // Attach click listener for editing (on the card itself, excluding the delete button)
                card.addEventListener('click', (e) => {
                    if (!e.target.closest('.delete-post-btn')) {
                        if (isAdminLoggedIn) {
                            openModal(post);
                        } else {
                            showLoginModal();
                        }
                    }
                });
                // Attach click listener for delete button
                if (isAdminLoggedIn) {
                    card.querySelector('.delete-post-btn').addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent card click event from firing
                        showDeleteConfirm(post.id);
                    });
                }

                return card;
            }

            function showDeleteConfirm(id) {
                postIdToDelete = id;
                deleteConfirmModal.classList.remove('hidden');
                deleteConfirmModal.classList.add('flex');
            }

            function hideDeleteConfirm() {
                deleteConfirmModal.classList.add('hidden');
                deleteConfirmModal.classList.remove('flex');
                postIdToDelete = null;
            }

            function deletePost() {
                if (postIdToDelete !== null) {
                    posts = posts.filter(post => post.id !== postIdToDelete);
                    savePosts();
                    populateFilters();
                    renderAllContent(); // Call the main rendering function
                    hideDeleteConfirm();
                }
            }


            function getFilteredPosts() {
                const selectedPlatform = platformFilter.value;
                const selectedStatus = statusFilter.value;

                const weekStart = new Date(currentWeekStartDate);
                weekStart.setHours(0, 0, 0, 0);

                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 7);
                weekEnd.setHours(0, 0, 0, 0);

                const allPostsFilteredByPlatform = posts.filter(post => {
                    return selectedPlatform === 'All Platforms' || post.platforms.includes(selectedPlatform);
                });

                // Filter for "Current Week Content" (non-posted statuses)
                let currentWeekNonPosted = allPostsFilteredByPlatform.filter(post =>
                    post.status !== 'Posted' &&
                    new Date(post.publishDate).setHours(0,0,0,0) >= weekStart.getTime() &&
                    new Date(post.publishDate).setHours(0,0,0,0) < weekEnd.getTime()
                );
                // Apply status filter ONLY to non-posted content
                if (selectedStatus !== 'All Statuses' && selectedStatus !== 'Posted') {
                    currentWeekNonPosted = currentWeekNonPosted.filter(post => post.status === selectedStatus);
                }


                // Filter for "Posted Content by Day" (only 'Posted' status for the current week)
                let currentWeekPostedByDay = allPostsFilteredByPlatform.filter(post =>
                    post.status === 'Posted' &&
                    new Date(post.publishDate).setHours(0,0,0,0) >= weekStart.getTime() &&
                    new Date(post.publishDate).setHours(0,0,0,0) < weekEnd.getTime()
                );
                // If the filter is explicitly set to something other than 'Posted', clear this section
                if (selectedStatus !== 'All Statuses' && selectedStatus !== 'Posted') {
                    currentWeekPostedByDay = [];
                }


                // "All Posted Content" (Archive) - always shows ALL posted content, only filtered by platform
                let allTimePosted = posts.filter(post => post.status === 'Posted');
                if (selectedPlatform !== 'All Platforms') {
                    allTimePosted = allTimePosted.filter(post => post.platforms.includes(selectedPlatform));
                }
                // If the status filter is NOT 'All Statuses' and NOT 'Posted', then hide the All Posted Content section
                if (selectedStatus !== 'All Statuses' && selectedStatus !== 'Posted') {
                    allTimePosted = [];
                }
                

                return {
                    currentWeekNonPosted: currentWeekNonPosted,
                    currentWeekPostedByDay: currentWeekPostedByDay,
                    allTimePosted: allTimePosted
                };
            }

            function renderAllContent() {
                const orderedDays = getOrderedDaysOfWeek(preferredWeekStartDay);
                const currentWeekRangeText = getWeekRangeText(currentWeekStartDate);
                const weekId = getCurrentWeekId();
                const isDarkMode = document.documentElement.classList.contains('dark');

                // Check for custom title
                const customTitle = customWeeklyTitles[weekId];
                if (customTitle) {
                    currentWeekPlannedTitle.textContent = customTitle;
                    currentWeekPostedTitle.textContent = customTitle;
                    customWeeklyTitleInput.value = customTitle; // Update input box with current custom title
                } else {
                    currentWeekPlannedTitle.textContent = currentWeekRangeText;
                    currentWeekPostedTitle.textContent = currentWeekRangeText;
                    customWeeklyTitleInput.value = ''; // Clear input if no custom title
                }
                
                // Update week navigation display (always date-based)
                currentWeekDisplay.textContent = currentWeekRangeText;

                // Clear all grid containers
                const currentWeekGrid = document.getElementById('current-week-grid');
                currentWeekGrid.innerHTML = '';
                const postedDailyGrid = document.getElementById('posted-daily-grid');
                postedDailyGrid.innerHTML = '';
                const allPostedContentContainer = document.getElementById('all-posted-content-container');
                allPostedContentContainer.innerHTML = '';

                // Dynamically create day columns for Current Week (Non-Posted)
                for (let i = 0; i < 7; i++) {
                    const dayColumn = document.createElement('div');
                    dayColumn.id = `current-week-day-column-${i}`; // Unique ID
                    
                    // Apply light mode specific classes for backgrounds
                    let dayClasses = `rounded-lg p-4 day-column`;
                    if (isDarkMode) {
                        dayClasses += ` dark:bg-gray-700`; // Default dark background for all days
                        if (orderedDays[i] === 'Saturday' || orderedDays[i] === 'Sunday') {
                            dayClasses += ` dark:bg-gray-800`; // Slightly darker for weekend in dark mode
                        }
                    } else {
                        dayClasses += ` light-mode-weekday`; // Default light blue for weekdays
                        if (orderedDays[i] === 'Saturday' || orderedDays[i] === 'Sunday') {
                            dayClasses += ` light-mode-weekend`; // Slightly different light blue for weekend
                        }
                    }
                    dayColumn.className = dayClasses;

                    dayColumn.innerHTML = `<h3 class="font-bold text-xl md:text-2xl mb-4 text-center text-brand-charcoal">${orderedDays[i]}</h3><div id="current-week-day-content-${i}" class="space-y-4"></div>`;
                    currentWeekGrid.appendChild(dayColumn);
                }

                // Dynamically create day columns for Posted Content by Day (Current Week)
                for (let i = 0; i < 7; i++) {
                    const dayColumn = document.createElement('div');
                    dayColumn.id = `posted-daily-day-column-${i}`; // Unique ID
                    
                    // Apply light mode specific classes for backgrounds
                    let dayClasses = `rounded-lg p-4 day-column`;
                    if (isDarkMode) {
                        dayClasses += ` dark:bg-gray-700`; // Default dark background for all days
                        if (orderedDays[i] === 'Saturday' || orderedDays[i] === 'Sunday') {
                            dayClasses += ` dark:bg-gray-800`; // Slightly darker for weekend in dark mode
                        }
                    } else {
                        dayClasses += ` light-mode-weekday`; // Default light blue for weekdays
                        if (orderedDays[i] === 'Saturday' || orderedDays[i] === 'Sunday') {
                            dayClasses += ` light-mode-weekend`; // Slightly different light blue for weekend
                        }
                    }
                    dayColumn.className = dayClasses;

                    dayColumn.innerHTML = `<h3 class="font-bold text-xl md:text-2xl mb-4 text-center text-brand-charcoal">${orderedDays[i]}</h3><div id="posted-daily-day-content-${i}" class="space-y-4"></div>`;
                    postedDailyGrid.appendChild(dayColumn);
                }

                const { currentWeekNonPosted, currentWeekPostedByDay, allTimePosted } = getFilteredPosts();

                // Render non-posted content for current week
                currentWeekNonPosted.forEach(post => {
                    const postDate = new Date(post.publishDate);
                    postDate.setHours(0,0,0,0);
                    
                    const startOfWeekOfPost = getWeekStartDate(postDate, preferredWeekStartDay);
                    const diffTime = postDate.getTime() - startOfWeekOfPost.getTime();
                    const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));

                    const container = document.getElementById(`current-week-day-content-${diffDays}`);
                    if (container) {
                        container.appendChild(createPostCard(post));
                    }
                });

                // Render posted content for current week, by day
                currentWeekPostedByDay.forEach(post => {
                    const postDate = new Date(post.publishDate);
                    postDate.setHours(0,0,0,0);
                    
                    const startOfWeekOfPost = getWeekStartDate(postDate, preferredWeekStartDay);
                    const diffTime = postDate.getTime() - startOfWeekOfPost.getTime();
                    const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));

                    const container = document.getElementById(`posted-daily-day-content-${diffDays}`);
                    if (container) {
                        container.appendChild(createPostCard(post));
                    }
                });

                // Render all posted content in its dedicated section
                allTimePosted.forEach(post => {
                    if (allPostedContentContainer) {
                        allPostedContentContainer.appendChild(createPostCard(post));
                    }
                });

                // Charts should use all *visible* data, so combine based on filters
                // Note: allTimePosted is now filtered by platform, but not status (unless status filter specifically hides it)
                const allVisiblePostsForCharts = [...currentWeekNonPosted, ...currentWeekPostedByDay, ...allTimePosted];
                renderCharts(allVisiblePostsForCharts);
                updateAdminUI(); // Update UI elements based on login status
            }

            function renderCharts(data) {
                const isDarkMode = document.documentElement.classList.contains('dark');
                const currentChartColors = getChartColors(isDarkMode);

                const platformCounts = {};
                data.forEach(post => {
                    post.platforms.forEach(p => {
                        platformCounts[p] = (platformCounts[p] || 0) + 1;
                    });
                });

                // Initialize all status counts to 0, including the new 'For Approval' status
                const statusCounts = { 'To Do': 0, 'In Progress': 0, 'For Approval': 0, 'Scheduled': 0, 'Posted': 0 };
                data.forEach(post => {
                    if (statusCounts.hasOwnProperty(post.status)) { // Ensure status exists in our predefined list
                        statusCounts[post.status]++;
                    }
                });

                const platformCtx = document.getElementById('platformChart').getContext('2d');
                if(platformChart) platformChart.destroy();
                platformChart = new Chart(platformCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(platformCounts),
                        datasets: [{
                            data: Object.values(platformCounts),
                            backgroundColor: currentChartColors.platforms,
                            borderColor: isDarkMode ? '#2d3748' : '#fff', // Adjust border for dark mode
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: isDarkMode ? '#e2e8f0' : '#333333' // Legend text color
                                }
                            }
                        }
                    }
                });

                const statusCtx = document.getElementById('statusChart').getContext('2d');
                if(statusChart) statusChart.destroy();
                statusChart = new Chart(statusCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(statusCounts),
                        datasets: [{
                            label: 'Number of Posts',
                            data: Object.values(statusCounts),
                            backgroundColor: Object.values(currentChartColors.statuses),
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1,
                                    color: isDarkMode ? '#e2e8f0' : '#333333' // Y-axis label color
                                }
                            },
                            x: {
                                ticks: {
                                    color: isDarkMode ? '#e2e8f0' : '#333333' // X-axis label color
                                }
                                /* Removed categoryPercentage and barPercentage for default behavior */
                            }
                        }
                    }
                });
            }

            function populateFilters() {
                const allPlatforms = new Set();
                posts.forEach(p => p.platforms.forEach(pf => allPlatforms.add(pf)));

                platformFilter.innerHTML = '<option>All Platforms</option>';
                Array.from(allPlatforms).sort().forEach(pf => { // Sort platforms alphabetically
                    const option = document.createElement('option');
                    option.textContent = pf;
                    platformFilter.appendChild(option);
                });
            }

            function openModal(post = null) {
                postForm.reset();
                if (post) {
                    modalTitle.textContent = 'Edit Content';
                    postIdInput.value = post.id;
                    document.getElementById('contentTopic').value = post.topic;
                    publishDateInputModal.value = post.publishDate; // Set the date input value
                    statusSelectModal.value = post.status;
                    platformsInputModal.value = post.platforms.join(', ');
                    document.getElementById('contentType').value = post.type;
                    document.getElementById('resources').value = post.resources || '';
                    document.getElementById('outputLink').value = post.outputLink || '';
                    document.getElementById('notes').value = post.notes;

                } else {
                    modalTitle.textContent = 'Add New Content';
                    postIdInput.value = '';
                    // Default to today's date for new posts
                    publishDateInputModal.value = formatDate(new Date());  
                    statusSelectModal.value = 'To Do';
                }
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                setTimeout(() => modalContent.classList.add('scale-100'), 10);
            }

            function closeModal() {
                modalContent.classList.remove('scale-100');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }, 300);
            }

            function handleFormSubmit(e) {
                e.preventDefault();
                const id = postIdInput.value;
                const publishDate = publishDateInputModal.value; // Get date directly from input

                const newPostData = {
                    topic: document.getElementById('contentTopic').value,
                    publishDate: publishDate, // Use the selected date directly
                    status: statusSelectModal.value,
                    platforms: platformsInputModal.value.split(',').map(p => p.trim()).filter(p => p !== ''),
                    type: document.getElementById('contentType').value,
                    resources: document.getElementById('resources').value,
                    outputLink: document.getElementById('outputLink').value,
                    notes: document.getElementById('notes').value,
                };

                if (id) {
                    const index = posts.findIndex(p => p.id == id);
                    posts[index] = { ...posts[index], ...newPostData };
                } else {
                    newPostData.id = Date.now();
                    posts.push(newPostData);
                }

                savePosts();
                populateFilters();
                statusFilter.value = 'All Statuses'; // Reset status filter to "All Statuses"
                renderAllContent();
                closeModal();
            }

            // Dark Mode Logic
            function toggleDarkMode() {
                document.documentElement.classList.toggle('dark');
                const isDarkMode = document.documentElement.classList.contains('dark');
                localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
                renderAllContent(); // Re-render to apply new day column colors
            }

            // Admin Login/Logout Logic
            function showLoginModal() {
                adminPasswordInput.value = ''; // Clear password field
                loginError.classList.add('hidden'); // Hide error message
                loginModal.classList.remove('hidden');
                loginModal.classList.add('flex');
            }

            function hideLoginModal() {
                loginModal.classList.add('hidden');
                loginModal.classList.remove('flex');
            }

            function login() {
                if (adminPasswordInput.value === ADMIN_PASSWORD) {
                    isAdminLoggedIn = true;
                    localStorage.setItem('isAdminLoggedIn', 'true');
                    hideLoginModal();
                    renderAllContent(); // Re-render to show editable elements
                } else {
                    loginError.classList.remove('hidden');
                }
            }

            function logout() {
                isAdminLoggedIn = false;
                localStorage.setItem('isAdminLoggedIn', 'false');
                renderAllContent(); // Re-render to hide editable elements
            }

            function updateAdminUI() {
                if (isAdminLoggedIn) {
                    addPostBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    addPostBtn.disabled = false;
                    exportDataBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    exportDataBtn.disabled = false;
                    importDataBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    importDataBtn.disabled = false;
                    setCustomTitleBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    setCustomTitleBtn.disabled = false;
                    clearCustomTitleBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    clearCustomTitleBtn.disabled = false;

                    adminLoginBtn.classList.add('hidden');
                    adminLogoutBtn.classList.remove('hidden');
                    loggedInUserDisplay.textContent = 'Logged in as Admin';
                } else {
                    addPostBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    addPostBtn.disabled = true;
                    exportDataBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    exportDataBtn.disabled = true;
                    importDataBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    importDataBtn.disabled = true;
                    setCustomTitleBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    setCustomTitleBtn.disabled = true;
                    clearCustomTitleBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    clearCustomTitleBtn.disabled = true;

                    adminLoginBtn.classList.remove('hidden');
                    adminLogoutBtn.classList.add('hidden');
                    loggedInUserDisplay.textContent = 'Not Logged In';
                }
            }

            // Apply dark mode preference on load
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.documentElement.classList.add('dark');
                darkModeToggle.checked = true;
            } else {
                darkModeToggle.checked = false;
            }

            // Event Listeners
            platformFilter.addEventListener('change', renderAllContent);
            statusFilter.addEventListener('change', renderAllContent);
            darkModeToggle.addEventListener('change', toggleDarkMode);

            weekStartDayFilter.addEventListener('change', (e) => {
                preferredWeekStartDay = e.target.value;
                localStorage.setItem('weekStartDay', preferredWeekStartDay);
                
                const middleOfCurrentDisplayedWeek = new Date(currentWeekStartDate);
                middleOfCurrentDisplayedWeek.setDate(middleOfCurrentDisplayedWeek.getDate() + 3);
                currentWeekStartDate = getWeekStartDate(middleOfCurrentDisplayedWeek, preferredWeekStartDay);  
                renderAllContent();
            });

            addPostBtn.addEventListener('click', () => {
                if (isAdminLoggedIn) {
                    openModal();
                } else {
                    showLoginModal();
                }
            });
            cancelBtn.addEventListener('click', closeModal);
            postForm.addEventListener('submit', handleFormSubmit);
            modal.addEventListener('click', (e) => {
                if(e.target === modal) {
                    closeModal();
                }
            });
            
            prevWeekBtn.addEventListener('click', () => {
                currentWeekStartDate.setDate(currentWeekStartDate.getDate() - 7);
                renderAllContent();
            });

            nextWeekBtn.addEventListener('click', () => {
                currentWeekStartDate.setDate(currentWeekStartDate.getDate() + 7);
                renderAllContent();
            });

            // Custom Title Event Listeners
            setCustomTitleBtn.addEventListener('click', () => {
                if (!isAdminLoggedIn) {
                    showLoginModal();
                    return;
                }
                const newTitle = customWeeklyTitleInput.value.trim();
                const weekId = getCurrentWeekId();
                if (newTitle) {
                    customWeeklyTitles[weekId] = newTitle;
                } else {
                    delete customWeeklyTitles[weekId]; // Remove if empty
                }
                localStorage.setItem('customWeeklyTitles', JSON.stringify(customWeeklyTitles));
                renderAllContent(); // Re-render to show updated title
            });

            clearCustomTitleBtn.addEventListener('click', () => {
                if (!isAdminLoggedIn) {
                    showLoginModal();
                    return;
                }
                const weekId = getCurrentWeekId();
                if (customWeeklyTitles[weekId]) {
                    delete customWeeklyTitles[weekId];
                    localStorage.setItem('customWeeklyTitles', JSON.stringify(customWeeklyTitles));
                    renderAllContent(); // Re-render to show date-based title
                }
            });

            // Export Data Function
            exportDataBtn.addEventListener('click', () => {
                if (!isAdminLoggedIn) {
                    showLoginModal();
                    return;
                }
                console.log('Export Data button clicked.'); // Debugging
                const dataToExport = {
                    posts: posts,
                    customWeeklyTitles: customWeeklyTitles,
                    darkMode: localStorage.getItem('darkMode'),
                    weekStartDay: localStorage.getItem('weekStartDay')
                };
                const jsonData = JSON.stringify(dataToExport, null, 2); // null, 2 for pretty printing

                const blob = new Blob([jsonData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `content_cowboy_data_${formatDate(new Date())}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                // Replaced alert with a message box for better UX
                alert('Calendar data exported successfully!');
            });

            // Import Data Function
            importDataBtn.addEventListener('click', () => {
                if (!isAdminLoggedIn) {
                    showLoginModal();
                    return;
                }
                console.log('Import Data button clicked.'); // Debugging
                importFileInput.click(); // Trigger the hidden file input
            });

            importFileInput.addEventListener('change', (event) => {
                console.log('File input change event fired.'); // Debugging
                const file = event.target.files[0];
                if (!file) {
                    console.log('No file selected or dialog cancelled.'); // Debugging
                    // Important: Reset the input value so the change event fires again if the user
                    // selects the *same* file after canceling.
                    event.target.value = '';  
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    console.log('FileReader loaded file.'); // Debugging
                    try {
                        const importedData = JSON.parse(e.target.result);
                        console.log('Imported data:', importedData); // Debugging

                        // Basic validation to ensure it's the right kind of data
                        if (importedData.posts && Array.isArray(importedData.posts)) {
                            posts = importedData.posts;
                            savePosts(); // Save the new posts

                            // Import other settings if present
                            if (importedData.customWeeklyTitles) {
                                customWeeklyTitles = importedData.customWeeklyTitles;
                                localStorage.setItem('customWeeklyTitles', JSON.stringify(customWeeklyTitles));
                            } else {
                                // If imported data doesn't have custom titles, clear existing ones
                                customWeeklyTitles = {};
                                localStorage.removeItem('customWeeklyTitles');
                            }

                            if (importedData.darkMode) {
                                localStorage.setItem('darkMode', importedData.darkMode);
                                // Immediately apply dark mode if needed
                                if (importedData.darkMode === 'enabled') {
                                    document.documentElement.classList.add('dark');
                                    darkModeToggle.checked = true;
                                } else {
                                    document.documentElement.classList.remove('dark');
                                    darkModeToggle.checked = false;
                                }
                            } else {
                                localStorage.removeItem('darkMode'); // Default to light if not specified
                                document.documentElement.classList.remove('dark');
                                darkModeToggle.checked = false;
                            }

                            if (importedData.weekStartDay) {
                                localStorage.setItem('weekStartDay', importedData.weekStartDay);
                                preferredWeekStartDay = importedData.weekStartDay;
                                weekStartDayFilter.value = preferredWeekStartDay;
                                // Reset current week start date based on new preference
                                currentWeekStartDate = getWeekStartDate(new Date(), preferredWeekStartDay);
                            } else {
                                localStorage.removeItem('weekStartDay'); // Default to Monday if not specified
                                preferredWeekStartDay = 'Monday';
                                weekStartDayFilter.value = preferredWeekStartDay;
                                currentWeekStartDate = getWeekStartDate(new Date(), preferredWeekStartDay);
                            }

                            populateFilters(); // Re-populate platform filter dropdown
                            renderAllContent(); // Re-render the entire calendar
                            alert('Calendar data imported successfully!');
                        } else {
                            alert('Invalid data file. Please select a valid Content Cowboy JSON export (expected "posts" array).');
                        }
                    } catch (error) {
                        console.error('Error parsing imported file:', error);
                        alert('Error importing data. Please ensure the file is a valid JSON.');
                    } finally {
                        // Crucially, reset the file input's value after processing
                        // so that if the user selects the same file again, the 'change' event still fires.
                        event.target.value = '';  
                    }
                };
                reader.onerror = () => {
                    alert('Failed to read file.');
                    event.target.value = ''; // Reset on error too
                };
                reader.readAsText(file);
            });


            // Delete confirmation button listeners
            cancelDeleteBtn.addEventListener('click', hideDeleteConfirm);
            confirmDeleteBtn.addEventListener('click', deletePost);
            deleteConfirmModal.addEventListener('click', (e) => {
                if(e.target === deleteConfirmModal) {
                    hideDeleteConfirm();
                }
            });

            // Admin Login Modal Listeners
            adminLoginBtn.addEventListener('click', showLoginModal);
            adminLogoutBtn.addEventListener('click', logout);
            cancelLoginBtn.addEventListener('click', hideLoginModal);
            submitLoginBtn.addEventListener('click', login);
            adminPasswordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    login();
                }
            });
            loginModal.addEventListener('click', (e) => {
                if(e.target === loginModal) {
                    hideLoginModal();
                }
            });

            // Initial render
            populateFilters();
            renderAllContent(); // This will also call updateAdminUI
        });
    </script>
</body>
</html>
